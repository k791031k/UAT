javascript:(async()=>{const API_URL_UAT='https://euisv-uat.apps.tocp4.kgilife.com.tw/euisw/euisb/api/caseQuery/query';const API_URL_PROD='https://euisv.apps.ocp4.kgilife.com.tw/euisw/euisb/api/caseQuery/query';const TOKEN_STORAGE_KEY='euisToken';const A17_TEXT_SETTINGS_STORAGE_KEY='kgilifeQueryTool_A17TextSettings_v3';const TOOL_MAIN_CONTAINER_ID='kgilifeQueryToolMainContainer_vFinal';const Z_INDEX_OVERLAY=2147483640;const Z_INDEX_MAIN_UI=2147483630;const Z_INDEX_NOTIFICATION=2147483647;const QUERYABLE_FIELD_DEFINITIONS=[{queryApiKey:'receiptNumber',queryDisplayName:'%E9%80%81%E9%87%91%E5%96%AE%E8%99%9F%E7%A2%BC',color:'#007bff'},{queryApiKey:'applyNumber',queryDisplayName:'%E5%8F%97%E7%90%86%E8%99%9F%E7%A2%BC',color:'#6f42c1'},{queryApiKey:'policyNumber',queryDisplayName:'%E4%BF%9D%E5%96%AE%E8%99%9F%E7%A2%BC',color:'#28a745'},{queryApiKey:'approvalNumber',queryDisplayName:'%E7%A2%BA%E8%AA%8D%E6%9B%B8%E7%B7%A8%E8%99%9F',color:'#fd7e14'},{queryApiKey:'insuredId',queryDisplayName:'%E8%A2%AB%E4%BF%9D%E4%BA%BA%EF%BC%A9%EF%BC%A4',color:'#17a2b8'}];const%20FIELD_DISPLAY_NAMES_MAP={applyNumber:'%E5%8F%97%E7%90%86%E8%99%9F%E7%A2%BC',policyNumber:'%E4%BF%9D%E5%96%AE%E8%99%9F%E7%A2%BC',approvalNumber:'%E7%A2%BA%E8%AA%8D%E6%9B%B8%E7%B7%A8%E8%99%9F',receiptNumber:'%E9%80%81%E9%87%91%E5%96%AE',insuredId:'%E8%A2%AB%E4%BF%9D%E4%BA%BA%EF%BC%A9%EF%BC%A4',statusCombined:'%E7%8B%80%E6%85%8B',mainStatus:'%E4%B8%BB%E7%8B%80%E6%85%8B',subStatus:'%E6%AC%A1%E7%8B%80%E6%85%8B',uwApproverUnit:'%E5%88%86%E5%85%AC%E5%8F%B8',uwApprover:'%E6%A0%B8%E4%BF%9D%E5%93%A1',approvalUser:'%E8%A6%86%E6%A0%B8',_queriedValue_:'%E6%9F%A5%E8%A9%A2%E5%80%BC',NO:'%E5%BA%8F%E8%99%9F',_apiQueryStatus:'%E6%9F%A5%E8%A9%A2%E7%B5%90%E6%9E%9C'};const%20ALL_DISPLAY_FIELDS_API_KEYS_MAIN=['applyNumber','policyNumber','approvalNumber','receiptNumber','insuredId','statusCombined','uwApproverUnit','uwApprover','approvalUser'];const%20UNIT_CODE_MAPPINGS={H:'%E6%A0%B8%E4%BF%9D%E9%83%A8',B:'%E5%8C%97%E4%B8%80',C:'%E5%8F%B0%E4%B8%AD',K:'%E9%AB%98%E9%9B%84',N:'%E5%8F%B0%E5%8D%97',P:'%E5%8C%97%E4%BA%8C',T:'%E6%A1%83%E7%AB%B9',G:'%E4%BF%9D%E4%BD%9C'};const%20A17_UNIT_BUTTONS_DEFS=[{id:'H',label:'H-%E7%B8%BD%E5%85%AC%E5%8F%B8',color:'#007bff'},{id:'B',label:'B-%E5%8C%97%E4%B8%80',color:'#28a745'},{id:'P',label:'P-%E5%8C%97%E4%BA%8C',color:'#ffc107'},{id:'T',label:'T-%E6%A1%83%E7%AB%B9',color:'#17a2b8'},{id:'C',label:'C-%E5%8F%B0%E4%B8%AD',color:'#fd7e14'},{id:'N',label:'N-%E5%8F%B0%E5%8D%97',color:'#6f42c1'},{id:'K',label:'K-%E9%AB%98%E9%9B%84',color:'#e83e8c'},{id:'UNDEF',label:'%E6%9F%A5%E7%84%A1%E5%96%AE%E4%BD%8D',color:'#546e7a'}];const%20UNIT_MAP_FIELD_API_KEY='uwApproverUnit';const%20A17_DEFAULT_TEXT_CONTENT=%22DEAR,\n\n%E4%BE%9D%E6%93%9A%E3%80%90%E7%AE%A1%E7%90%86%E5%A0%B1%E8%A1%A8%EF%BC%9AA17%20%E6%96%B0%E5%A5%91%E7%B4%84%E7%95%B0%E5%B8%B8%E5%B8%B3%E5%8B%99%E3%80%91%E6%89%80%E8%BC%89%E5%85%A7%E5%AE%B9%EF%BC%8C%E5%A0%B1%E8%A1%A8%E4%B8%AD%E5%88%97%E7%A4%BA%E4%B9%8B%E9%80%81%E9%87%91%E5%96%AE%E8%99%9F%E7%A2%BC%EF%BC%8C%E6%B6%89%E5%8F%8A%E5%A4%9A%E9%A0%85%E5%B8%B3%E5%8B%99%E7%95%B0%E5%B8%B8%E6%83%85%E5%BD%A2%EF%BC%8C%E4%BE%8B%E5%A6%82%EF%BC%9A%E6%BA%A2%E7%B9%B3%E3%80%81%E7%9F%AD%E6%94%B6%E3%80%81%E5%8F%96%E6%B6%88%E4%BB%B6%E9%9C%80%E9%80%80%E8%B2%BB%E3%80%81%E4%BB%A5%E5%8F%8A%E7%84%A1%E7%9B%B8%E5%B0%8D%E6%87%89%E4%B9%8B%E6%A1%88%E4%BB%B6%E7%AD%89%E5%95%8F%E9%A1%8C%E3%80%82\n\n%E6%9C%AC%E9%80%B1%E6%88%91%E5%80%91%E5%B7%B2%E9%80%90%E7%AD%86%E6%9F%A5%E8%A9%A2%E8%A9%B2%E7%AD%89%E7%95%B0%E5%B8%B8%E5%B8%B3%E5%8B%99%EF%BC%8C%E7%B5%90%E6%9E%9C%E9%A1%AF%E7%A4%BA%EF%BC%8C%E9%80%99%E4%BA%9B%E9%80%81%E9%87%91%E5%96%AE%E6%87%89%E5%B0%8D%E6%87%89%E8%87%B3%E4%B8%8B%E8%A1%A8%E6%89%80%E5%88%97%E4%B9%8B%E6%96%B0%E5%A5%91%E7%B4%84%E6%A1%88%E4%BB%B6%E3%80%82%E7%82%BA%E5%88%A9%E5%BE%8C%E7%BA%8C%E5%B8%B3%E5%8B%99%E8%99%95%E7%90%86%EF%BC%8C%E6%95%AC%E8%AB%8B%E5%8D%94%E5%8A%A9%E7%A2%BA%E8%AA%8D%E5%90%84%E6%A1%88%E4%BB%B6%E4%B9%8B%E5%AF%A6%E9%9A%9B%E5%B8%B3%E5%8B%99%E7%8B%80%E6%B3%81%EF%BC%8C%E4%B8%A6%E5%A6%82%E6%9C%89%E9%9C%80%E8%AA%BF%E6%95%B4%E6%88%96%E8%99%95%E7%90%86%E4%BA%8B%E9%A0%85%EF%BC%8C%E8%AB%8B%E4%B8%80%E4%BD%B5%E5%8D%94%E5%8A%A9%E8%BE%A6%E7%90%86%EF%BC%8C%E8%AC%9D%E8%AC%9D%E3%80%82%22;let%20CURRENT_API_URL='';let%20apiAuthToken=localStorage.getItem(TOKEN_STORAGE_KEY);let%20selectedQueryDefinitionGlobal=QUERYABLE_FIELD_DEFINITIONS[0];let%20originalQueryResults=[];let%20baseA17MasterData=[];let%20currentTableInstance={sortDirections:{},currentHeaders:[],isA17Mode:!1,mainUIElement:null,tableBodyElement:null,tableHeadElement:null,a17UnitButtonsContainer:null,};let%20a17ModeState={isActive:!1,selectedUnits:new%20Set(),textSettings:{mainContent:A17_DEFAULT_TEXT_CONTENT,mainFontSize:12,mainLineHeight:1.5,mainFontColor:'#333333',dateFontSize:8,dateLineHeight:1.2,dateFontColor:'#555555',genDateOffset:-3,compDateOffset:0,},};let%20csvImportState={fileName:'',rawHeaders:[],rawData:[],selectedColForQueryName:null,selectedColsForA17Merge:[],isA17CsvPrepared:!1,};let%20isEditMode=!1;let%20dragState={dragging:!1,startX:0,startY:0,initialX:0,initialY:0};let%20a17ButtonLongPressTimer=null;function%20escapeHtml(unsafe){if(typeof%20unsafe!=='string')return%20unsafe===null||unsafe===undefined?'':String(unsafe);return%20unsafe.replace(/[&%3C%3E%22']/g,m=%3E({'&':'&','%3C':'%3C','%3E':'%3E','%22':'%22',%22'%22:'&#039;'})[m])}function%20displaySystemNotification(message,isError=!1,duration=3000){const%20id=TOOL_MAIN_CONTAINER_ID+'_Notification';document.getElementById(id)?.remove();const%20n=document.createElement('div');n.id=id;n.style.cssText=%60position:fixed;top:20px;right:20px;background-color:${isError%20?%20'#dc3545'%20:%20'#28a745'};color:white;padding:10px%2015px;border-radius:5px;z-index:${Z_INDEX_NOTIFICATION};font-size:14px;font-family:'Microsoft%20JhengHei',Arial,sans-serif;box-shadow:0%202px%2010px%20rgba(0,0,0,0.2);transform:translateX(calc(100%%20+%2025px));transition:transform%200.3s%20ease-in-out;display:flex;align-items:center;%60;const%20i=document.createElement('span');i.style.marginRight='8px';i.style.fontSize='16px';i.innerHTML=isError?'&#x26A0;':'&#x2714;';n.appendChild(i);n.appendChild(document.createTextNode(message));document.body.appendChild(n);setTimeout(()=%3En.style.transform='translateX(0)',50);setTimeout(()=%3E{n.style.transform='translateX(calc(100%%20+%2025px))';setTimeout(()=%3En.remove(),300)},duration)}function%20createDialogBase(idSuffix,contentHtml,minWidth='350px',maxWidth='600px',customStyles=''){const%20id=TOOL_MAIN_CONTAINER_ID+idSuffix;document.getElementById(id+'_overlay')?.remove();const%20overlay=document.createElement('div');overlay.id=id+'_overlay';overlay.style.cssText=%60position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.6);z-index:${Z_INDEX_OVERLAY};display:flex;align-items:center;justify-content:center;font-family:'Microsoft%20JhengHei',Arial,sans-serif;backdrop-filter:blur(2px);%60;const%20dialog=document.createElement('div');dialog.id=id+'_dialog';dialog.style.cssText=%60background:#fff;padding:20px%2025px;border-radius:8px;box-shadow:0%205px%2020px%20rgba(0,0,0,0.25);min-width:${minWidth};max-width:${maxWidth};width:auto;animation:qtDialogAppear%200.2s%20ease-out;${customStyles}%60;dialog.innerHTML=contentHtml;overlay.appendChild(dialog);document.body.appendChild(overlay);const%20styleEl=document.createElement('style');styleEl.textContent=%60@keyframes%20qtDialogAppear{from{opacity:0;transform:scale(0.95)}to{opacity:1;transform:scale(1)}}.qt-dialog-btn{border:none;padding:8px%2015px;border-radius:4px;font-size:13px;cursor:pointer;transition:opacity%200.2s%20ease,transform%200.1s%20ease;font-weight:500;margin-left:8px;}.qt-dialog-btn:hover{opacity:0.85;}.qt-dialog-btn:active{transform:scale(0.98);}.qt-dialog-btn-blue{background:#007bff;color:white;}.qt-dialog-btn-grey{background:#6c757d;color:white;}.qt-dialog-btn-red{background:#dc3545;color:white;}.qt-dialog-btn-orange{background:#fd7e14;color:white;}.qt-dialog-btn-green{background:#28a745;color:white;}.qt-dialog-title{margin:0%200%2015px%200;color:#333;font-size:18px;text-align:center;font-weight:600;}.qt-input,.qt-textarea,.qt-select{width:calc(100%%20-%2018px);padding:9px;border:1px%20solid%20#ccc;border-radius:4px;font-size:13px;margin-bottom:15px;color:#333;box-sizing:border-box;}.qt-textarea{min-height:70px;resize:vertical;}.qt-dialog-flex-end{display:flex;justify-content:flex-end;margin-top:15px;}.qt-dialog-flex-between{display:flex;justify-content:space-between;align-items:center;margin-top:15px;}%60;dialog.appendChild(styleEl);return{overlay,dialog}}function%20extractName(strVal){if(!strVal||typeof%20strVal!=='string')return'';const%20matchResult=strVal.match(/^[\u4e00-\u9fa5\uff0a*\u00b7\uff0e]+/);return%20matchResult?matchResult[0]:strVal.split('%20')[0]}function%20getFirstLetter(unitString){if(!unitString||typeof%20unitString!=='string')return'Z';for(let%20i=0;i%3CunitString.length;i++){const%20char=unitString.charAt(i).toUpperCase();if(/[A-Z]/.test(char))return%20char}return'Z'}function%20formatDate(date){const%20y=date.getFullYear();const%20m=String(date.getMonth()+1).padStart(2,'0');const%20d=String(date.getDate()).padStart(2,'0');return%20%60${y}${m}${d}%60}function%20createEnvSelectionDialog(){return%20new%20Promise(resolve=%3E{const%20contentHtml=%60%3Ch3%20class=%22qt-dialog-title%22%3E%E9%81%B8%E6%93%87%E6%9F%A5%E8%A9%A2%E7%92%B0%E5%A2%83%3C/h3%3E%3Cdiv%20style=%22display:flex;%20gap:10px;%20justify-content:center;%22%3E%3Cbutton%20id=%22qt-env-uat%22%20class=%22qt-dialog-btn%20qt-dialog-btn-green%22%20style=%22flex-grow:1;%22%3E%E6%B8%AC%E8%A9%A6%20(UAT)%3C/button%3E%3Cbutton%20id=%22qt-env-prod%22%20class=%22qt-dialog-btn%20qt-dialog-btn-orange%22%20style=%22flex-grow:1;%22%3E%E6%AD%A3%E5%BC%8F%20(PROD)%3C/button%3E%3C/div%3E%3Cdiv%20style=%22text-align:center;%20margin-top:15px;%22%3E%3Cbutton%20id=%22qt-env-cancel%22%20class=%22qt-dialog-btn%20qt-dialog-btn-grey%22%3E%E5%8F%96%E6%B6%88%3C/button%3E%3C/div%3E%60;const{overlay}=createDialogBase('_EnvSelect',contentHtml,'300px','auto');const%20closeDialog=(value)=%3E{overlay.remove();document.removeEventListener('keydown',escListener);resolve(value)};const%20escListener=(e)=%3E{if(e.key==='Escape')closeDialog(null);};document.addEventListener('keydown',escListener);overlay.querySelector('#qt-env-uat').onclick=()=%3EcloseDialog('test');overlay.querySelector('#qt-env-prod').onclick=()=%3EcloseDialog('prod');overlay.querySelector('#qt-env-cancel').onclick=()=%3EcloseDialog(null)})}function%20createTokenDialog(attempt=1){return%20new%20Promise(resolve=%3E{const%20contentHtml=%60%3Ch3%20class=%22qt-dialog-title%22%3EAPI%20TOKEN%20%E8%A8%AD%E5%AE%9A%3C/h3%3E%3Cinput%20type=%22password%22%20id=%22qt-token-input%22%20class=%22qt-input%22%20placeholder=%22%E8%AB%8B%E8%BC%B8%E5%85%A5%E6%82%A8%E7%9A%84%20API%20TOKEN%22%3E${attempt%20%3E%201%20?%20%60%3Cp%20style=%22color:red;%20font-size:12px;%20text-align:center;%20margin-bottom:10px;%22%3EToken%E9%A9%97%E8%AD%89%E5%A4%B1%E6%95%97%EF%BC%8C%E8%AB%8B%E9%87%8D%E6%96%B0%E8%BC%B8%E5%85%A5%E3%80%82%3C/p%3E%60%20:%20''}%3Cdiv%20class=%22qt-dialog-flex-between%22%3E%3Cbutton%20id=%22qt-token-skip%22%20class=%22qt-dialog-btn%20qt-dialog-btn-orange%22%3E%E7%95%A5%E9%81%8E%3C/button%3E%3Cdiv%3E%3Cbutton%20id=%22qt-token-close-tool%22%20class=%22qt-dialog-btn%20qt-dialog-btn-red%22%3E%E9%97%9C%E9%96%89%E5%B7%A5%E5%85%B7%3C/button%3E%3Cbutton%20id=%22qt-token-ok%22%20class=%22qt-dialog-btn%20qt-dialog-btn-blue%22%3E${attempt%20%3E%201%20?%20'%E9%87%8D%E8%A9%A6'%20:%20'%E7%A2%BA%E5%AE%9A'}%3C/button%3E%3C/div%3E%3C/div%3E%60;const{overlay}=createDialogBase('_Token',contentHtml,'320px','auto');const%20inputEl=overlay.querySelector('#qt-token-input');inputEl.focus();if(attempt%3E2){const%20okBtn=overlay.querySelector('#qt-token-ok');okBtn.disabled=!0;okBtn.style.opacity='0.5';okBtn.style.cursor='not-allowed';displaySystemNotification('Token%E5%A4%9A%E6%AC%A1%E9%A9%97%E8%AD%89%E5%A4%B1%E6%95%97',!0,4000)}const%20closeDialog=(value)=%3E{overlay.remove();document.removeEventListener('keydown',escListener);resolve(value)};const%20escListener=(e)=%3E{if(e.key==='Escape')closeDialog('_token_dialog_cancel_');};document.addEventListener('keydown',escListener);overlay.querySelector('#qt-token-ok').onclick=()=%3EcloseDialog(inputEl.value.trim());overlay.querySelector('#qt-token-close-tool').onclick=()=%3EcloseDialog('_close_tool_');overlay.querySelector('#qt-token-skip').onclick=()=%3EcloseDialog('_skip_token_')})}function%20createQuerySetupDialog(){return%20new%20Promise(resolve=%3E{const%20queryButtonsHtml=QUERYABLE_FIELD_DEFINITIONS.map(def=%3E%60%3Cbutton%20class=%22qt-querytype-btn%22%20data-apikey=%22${def.queryApiKey}%22%20style=%22background-color:${def.color};%20color:white;%20border:%202px%20solid%20transparent;%20padding:%208px%2010px;%20flex-grow:%201;%20border-radius:%204px;%20font-size:%2013px;%20font-weight:%20500;%20cursor:%20pointer;%22%3E${escapeHtml(def.queryDisplayName)}%3C/button%3E%60).join('');const%20contentHtml=%60%3Ch3%20class=%22qt-dialog-title%22%3E%E6%9F%A5%E8%A9%A2%E6%A2%9D%E4%BB%B6%E8%A8%AD%E5%AE%9A%3C/h3%3E%3Cdiv%20style=%22margin-bottom:10px;%20font-size:13px;%20color:#555;%22%3E%E9%81%B8%E6%93%87%E6%9F%A5%E8%A9%A2%E6%AC%84%E4%BD%8D%E9%A1%9E%E5%9E%8B%EF%BC%9A%3C/div%3E%3Cdiv%20id=%22qt-querytype-buttons%22%20style=%22display:flex;%20flex-wrap:wrap;%20gap:8px;%20margin-bottom:15px;%22%3E${queryButtonsHtml}%3C/div%3E%3Cdiv%20style=%22margin-bottom:5px;%20font-size:13px;%20color:#555;%22%3E%E8%BC%B8%E5%85%A5%E6%9F%A5%E8%A9%A2%E5%80%BC%20(%E5%8F%AF%E5%A4%9A%E7%AD%86%EF%BC%8C%E4%BB%A5%E6%8F%9B%E8%A1%8C/%E7%A9%BA%E6%A0%BC/%E9%80%97%E8%99%9F/%E5%88%86%E8%99%9F%E5%88%86%E9%9A%94)%EF%BC%9A%3C/div%3E%3Ctextarea%20id=%22qt-queryvalues-input%22%20class=%22qt-textarea%22%20placeholder=%22%E8%AB%8B%E5%85%88%E9%81%B8%E6%93%87%E4%B8%8A%E6%96%B9%E6%9F%A5%E8%A9%A2%E6%AC%84%E4%BD%8D%E9%A1%9E%E5%9E%8B%22%3E%3C/textarea%3E%3Cdiv%20style=%22margin-bottom:15px;%22%3E%3Cbutton%20id=%22qt-csv-import-btn%22%20class=%22qt-dialog-btn%20qt-dialog-btn-grey%22%20style=%22margin-left:0;%22%3E%E5%BE%9ECSV/TXT%E5%8C%AF%E5%85%A5...%3C/button%3E%3Cspan%20id=%22qt-csv-filename-display%22%20style=%22font-size:12px;%20color:#666;%20margin-left:10px;%22%3E%3C/span%3E%3C/div%3E%3Cdiv%20class=%22qt-dialog-flex-between%22%3E%3Cbutton%20id=%22qt-clear-all-input-btn%22%20class=%22qt-dialog-btn%20qt-dialog-btn-orange%22%3E%E6%B8%85%E9%99%A4%E6%89%80%E6%9C%89%E8%BC%B8%E5%85%A5%3C/button%3E%3Cdiv%3E%3Cbutton%20id=%22qt-querysetup-cancel%22%20class=%22qt-dialog-btn%20qt-dialog-btn-grey%22%3E%E5%8F%96%E6%B6%88%3C/button%3E%3Cbutton%20id=%22qt-querysetup-ok%22%20class=%22qt-dialog-btn%20qt-dialog-btn-blue%22%3E%E9%96%8B%E5%A7%8B%E6%9F%A5%E8%A9%A2%3C/button%3E%3C/div%3E%3C/div%3E%3Cinput%20type=%22file%22%20id=%22qt-file-input-hidden%22%20accept=%22.csv,.txt%22%20style=%22display:none;%22%3E%60;const{overlay,dialog}=createDialogBase('_QuerySetup',contentHtml,'480px','auto');const%20queryValuesInput=overlay.querySelector('#qt-queryvalues-input');const%20typeButtons=overlay.querySelectorAll('.qt-querytype-btn');const%20csvImportBtn=overlay.querySelector('#qt-csv-import-btn');const%20fileInputHidden=overlay.querySelector('#qt-file-input-hidden');const%20csvFilenameDisplay=overlay.querySelector('#qt-csv-filename-display');function%20setActiveButton(apiKey){typeButtons.forEach(btn=%3E{const%20isSelected=btn.dataset.apikey===apiKey;btn.style.border=isSelected?%602px%20solid%20${btn.style.backgroundColor}%60:'2px%20solid%20transparent';btn.style.boxShadow=isSelected?%600%200%208px%20${btn.style.backgroundColor}70%60:'none';if(isSelected){selectedQueryDefinitionGlobal=QUERYABLE_FIELD_DEFINITIONS.find(d=%3Ed.queryApiKey===apiKey);queryValuesInput.placeholder=%60%E8%AB%8B%E8%BC%B8%E5%85%A5${selectedQueryDefinitionGlobal.queryDisplayName}(%E5%8F%AF%E5%A4%9A%E7%AD%86...)%60}})}typeButtons.forEach(btn=%3Ebtn.onclick=()=%3E{setActiveButton(btn.dataset.apikey);queryValuesInput.focus()});setActiveButton(selectedQueryDefinitionGlobal.queryApiKey);csvImportBtn.onclick=()=%3EfileInputHidden.click();fileInputHidden.onchange=async(e)=%3E{const%20file=e.target.files[0];if(!file)return;csvFilenameDisplay.textContent=%60%E5%B7%B2%E9%81%B8:%20${file.name}%60;try{const%20text=await%20file.text();const%20lines=text.split(/\r?\n/).filter(line=%3Eline.trim()!=='');if(lines.length===0){displaySystemNotification('CSV%E6%AA%94%E6%A1%88%E7%82%BA%E7%A9%BA',!0);return}const%20headers=lines[0].split(/,|;|\t/).map(h=%3Eh.trim().replace(/^%22|%22$/g,''));const%20purpose=await%20createCSVPurposeDialog();if(!purpose){csvFilenameDisplay.textContent='';fileInputHidden.value='';return}if(purpose==='fillQueryValues'){const%20columnIndex=await%20createCSVColumnSelectionDialog(headers,%22%E9%81%B8%E6%93%87%E5%8C%85%E5%90%AB%E6%9F%A5%E8%A9%A2%E5%80%BC%E7%9A%84%E6%AC%84%E4%BD%8D%EF%BC%9A%22);if(columnIndex===null||columnIndex===undefined){csvFilenameDisplay.textContent='';fileInputHidden.value='';return}const%20values=[];for(let%20i=1;i%3Clines.length;i++){const%20cols=lines[i].split(/,|;|\t/).map(c=%3Ec.trim().replace(/^%22|%22$/g,''));if(cols[columnIndex]&&cols[columnIndex].trim()!==%22%22)values.push(cols[columnIndex].trim());}queryValuesInput.value=Array.from(new%20Set(values)).join('\n');displaySystemNotification('%E6%9F%A5%E8%A9%A2%E5%80%BC%E5%B7%B2%E5%BE%9ECSV%E5%A1%AB%E5%85%A5',!1);csvImportState={...csvImportState,fileName:file.name,rawHeaders:headers,rawData:lines.slice(1).map(line=%3Eline.split(/,|;|\t/).map(c=%3Ec.trim().replace(/^%22|%22$/g,''))),selectedColForQueryName:headers[columnIndex],isA17CsvPrepared:!1,selectedColsForA17Merge:[]}}else%20if(purpose==='prepareA17Merge'){const%20selectedHeadersForA17=await%20createCSVColumnCheckboxDialog(headers,%22%E5%8B%BE%E9%81%B8%E8%A6%81%E5%9C%A8A17%E8%A1%A8%E6%A0%BC%E4%B8%AD%E9%A1%AF%E7%A4%BA%E7%9A%84CSV%E6%AC%84%E4%BD%8D%EF%BC%9A%22);if(!selectedHeadersForA17||selectedHeadersForA17.length===0){csvFilenameDisplay.textContent='';fileInputHidden.value='';return}csvImportState={...csvImportState,fileName:file.name,rawHeaders:headers,rawData:lines.slice(1).map(line=%3Eline.split(/,|;|\t/).map(c=%3Ec.trim().replace(/^%22|%22$/g,''))),selectedColsForA17Merge:selectedHeadersForA17,isA17CsvPrepared:!0,selectedColForQueryName:null};displaySystemNotification(%60%E5%B7%B2%E9%81%B8%20${selectedHeadersForA17.length}%20%E5%80%8BCSV%E6%AC%84%E4%BD%8D%E4%BE%9BA17%E5%90%88%E4%BD%B5%60,!1)}}catch(err){console.error(%22%E8%99%95%E7%90%86CSV%E9%8C%AF%E8%AA%A4:%22,err);displaySystemNotification('%E8%AE%80%E5%8F%96CSV%E5%A4%B1%E6%95%97',!0);csvFilenameDisplay.textContent=''}fileInputHidden.value=''};overlay.querySelector('#qt-clear-all-input-btn').onclick=()=%3E{queryValuesInput.value='';csvFilenameDisplay.textContent='';csvImportState={fileName:'',rawHeaders:[],rawData:[],selectedColForQueryName:null,selectedColsForA17Merge:[],isA17CsvPrepared:!1};fileInputHidden.value='';displaySystemNotification('%E6%89%80%E6%9C%89%E8%BC%B8%E5%85%A5%E5%B7%B2%E6%B8%85%E9%99%A4',!1)};const%20closeDialog=(value)=%3E{overlay.remove();document.removeEventListener('keydown',escListener);resolve(value)};const%20escListener=(e)=%3E{if(e.key==='Escape')closeDialog(null);};document.addEventListener('keydown',escListener);overlay.querySelector('#qt-querysetup-ok').onclick=()=%3E{const%20values=queryValuesInput.value.trim();if(!selectedQueryDefinitionGlobal){displaySystemNotification('%E8%AB%8B%E9%81%B8%E6%9F%A5%E8%A9%A2%E6%AC%84%E4%BD%8D%E9%A1%9E%E5%9E%8B',!0);return}if(!values){displaySystemNotification(%60%E8%AB%8B%E8%BC%B8%E5%85%A5${selectedQueryDefinitionGlobal.queryDisplayName}%60,!0);queryValuesInput.focus();return}closeDialog({selectedApiKey:selectedQueryDefinitionGlobal.queryApiKey,queryValues:values})};overlay.querySelector('#qt-querysetup-cancel').onclick=()=%3EcloseDialog(null)})}function%20createCSVPurposeDialog(){return%20new%20Promise(resolve=%3E{const%20contentHtml=%60%3Ch3%20class=%22qt-dialog-title%22%3E%E9%81%B8%E6%93%87CSV%E6%AA%94%E6%A1%88%E7%94%A8%E9%80%94%3C/h3%3E%3Cdiv%20style=%22display:flex;%20flex-direction:column;%20gap:10px;%22%3E%3Cbutton%20id=%22qt-csv-purpose-query%22%20class=%22qt-dialog-btn%20qt-dialog-btn-blue%22%20style=%22margin-left:0;%22%3E%E5%B0%87CSV%E6%9F%90%E6%AC%84%E4%BD%9C%E7%82%BA%E6%9F%A5%E8%A9%A2%E5%80%BC%3C/button%3E%3Cbutton%20id=%22qt-csv-purpose-a17%22%20class=%22qt-dialog-btn%20qt-dialog-btn-green%22%20style=%22margin-left:0;%22%3E%E5%8B%BE%E9%81%B8CSV%E6%AC%84%E4%BD%8D%E4%BE%9BA17%E5%90%88%E4%BD%B5%E9%A1%AF%E7%A4%BA%3C/button%3E%3C/div%3E%3Cdiv%20style=%22text-align:center;%20margin-top:15px;%22%3E%3Cbutton%20id=%22qt-csv-purpose-cancel%22%20class=%22qt-dialog-btn%20qt-dialog-btn-grey%22%3E%E5%8F%96%E6%B6%88%3C/button%3E%3C/div%3E%60;const{overlay}=createDialogBase('_CSVPurpose',contentHtml,'300px','auto');const%20closeDialog=(value)=%3E{overlay.remove();document.removeEventListener('keydown',escListener);resolve(value)};const%20escListener=(e)=%3E{if(e.key==='Escape')closeDialog(null);};document.addEventListener('keydown',escListener);overlay.querySelector('#qt-csv-purpose-query').onclick=()=%3EcloseDialog('fillQueryValues');overlay.querySelector('#qt-csv-purpose-a17').onclick=()=%3EcloseDialog('prepareA17Merge');overlay.querySelector('#qt-csv-purpose-cancel').onclick=()=%3EcloseDialog(null)})}function%20createCSVColumnSelectionDialog(headers,title){return%20new%20Promise(resolve=%3E{let%20optionsHtml=headers.map((header,index)=%3E%60%3Cbutton%20class=%22qt-dialog-btn%20qt-dialog-btn-blue%22%20data-index=%22${index}%22%20style=%22margin:5px;%20width:%20calc(50%%20-%2010px);%20text-overflow:%20ellipsis;%20overflow:%20hidden;%20white-space:%20nowrap;%22%3E${escapeHtml(header)}%3C/button%3E%60).join('');const%20contentHtml=%60%3Ch3%20class=%22qt-dialog-title%22%3E${escapeHtml(title)}%3C/h3%3E%3Cdiv%20style=%22display:flex;%20flex-wrap:wrap;%20justify-content:center;%20max-height:300px;%20overflow-y:auto;%20margin-bottom:15px;%22%3E${optionsHtml}%3C/div%3E%3Cdiv%20style=%22text-align:center;%22%3E%3Cbutton%20id=%22qt-csvcol-cancel%22%20class=%22qt-dialog-btn%20qt-dialog-btn-grey%22%3E%E5%8F%96%E6%B6%88%3C/button%3E%3C/div%3E%60;const{overlay,dialog}=createDialogBase('_CSVColSelect',contentHtml,'400px','auto');const%20closeDialog=(value)=%3E{overlay.remove();document.removeEventListener('keydown',escListener);resolve(value)};const%20escListener=(e)=%3E{if(e.key==='Escape')closeDialog(null);};document.addEventListener('keydown',escListener);dialog.querySelectorAll('.qt-dialog-btn[data-index]').forEach(btn=%3E{btn.onclick=()=%3EcloseDialog(parseInt(btn.dataset.index))});overlay.querySelector('#qt-csvcol-cancel').onclick=()=%3EcloseDialog(null)})}function%20createCSVColumnCheckboxDialog(headers,title){return%20new%20Promise(resolve=%3E{let%20checkboxesHtml=headers.map((header,index)=%3E%60%3Cdiv%20style=%22margin-bottom:%208px;%20display:flex;%20align-items:center;%22%3E%3Cinput%20type=%22checkbox%22%20id=%22qt-csv-header-cb-${index}%22%20value=%22${escapeHtml(header)}%22%20style=%22margin-right:8px;%20transform:scale(1.2);%22%3E%3Clabel%20for=%22qt-csv-header-cb-${index}%22%20style=%22font-size:14px;%22%3E${escapeHtml(header)}%3C/label%3E%3C/div%3E%60).join('');const%20contentHtml=%60%3Ch3%20class=%22qt-dialog-title%22%3E${escapeHtml(title)}%3C/h3%3E%3Cdiv%20style=%22max-height:%20300px;%20overflow-y:%20auto;%20margin-bottom:%2015px;%20border:%201px%20solid%20#eee;%20padding:%2010px;%20border-radius:%204px;%22%3E${checkboxesHtml}%3C/div%3E%3Cdiv%20class=%22qt-dialog-flex-end%22%3E%3Cbutton%20id=%22qt-csvcb-cancel%22%20class=%22qt-dialog-btn%20qt-dialog-btn-grey%22%3E%E5%8F%96%E6%B6%88%3C/button%3E%3Cbutton%20id=%22qt-csvcb-ok%22%20class=%22qt-dialog-btn%20qt-dialog-btn-blue%22%3E%E7%A2%BA%E5%AE%9A%E5%8B%BE%E9%81%B8%3C/button%3E%3C/div%3E%60;const{overlay,dialog}=createDialogBase('_CSVCheckbox',contentHtml,'400px','auto');const%20closeDialog=(value)=%3E{overlay.remove();document.removeEventListener('keydown',escListener);resolve(value)};const%20escListener=(e)=%3E{if(e.key==='Escape')closeDialog(null);};document.addEventListener('keydown',escListener);overlay.querySelector('#qt-csvcb-ok').onclick=()=%3E{const%20selected=[];dialog.querySelectorAll('input[type=%22checkbox%22]:checked').forEach(cb=%3Eselected.push(cb.value));if(selected.length===0){displaySystemNotification('%E8%AB%8B%E8%87%B3%E5%B0%91%E5%8B%BE%E9%81%B8%E4%B8%80%E5%80%8B%E6%AC%84%E4%BD%8D',!0);return}closeDialog(selected)};overlay.querySelector('#qt-csvcb-cancel').onclick=()=%3EcloseDialog(null)})}function%20createA17TextSettingDialog(){return%20new%20Promise(resolve=%3E{const%20s=a17ModeState.textSettings;const%20contentHtml=%60%3Ch3%20class=%22qt-dialog-title%22%3EA17%20%E9%80%9A%E7%9F%A5%E6%96%87%E6%9C%AC%E8%A8%AD%E5%AE%9A%3C/h3%3E%3Cdiv%20style=%22display:grid;%20grid-template-columns:%201fr;%20gap:%2015px;%22%3E%3Cdiv%3E%3Clabel%20for=%22qt-a17-mainContent%22%20style=%22font-weight:bold;%20font-size:13px;%20display:block;%20margin-bottom:5px;%22%3E%E4%B8%BB%E6%96%87%E6%A1%88%E5%85%A7%E5%AE%B9%EF%BC%9A%3C/label%3E%3Ctextarea%20id=%22qt-a17-mainContent%22%20class=%22qt-textarea%22%20style=%22height:150px;%22%3E${escapeHtml(s.mainContent)}%3C/textarea%3E%3Cdiv%20style=%22display:flex;%20gap:10px;%20margin-top:5px;%20flex-wrap:wrap;%22%3E%3Clabel%20style=%22font-size:12px;%22%3E%E5%AD%97%E9%AB%94%E5%A4%A7%E5%B0%8F:%20%3Cinput%20type=%22number%22%20id=%22qt-a17-mainFontSize%22%20value=%22${s.mainFontSize}%22%20min=%228%22%20max=%2224%22%20step=%220.5%22%20class=%22qt-input%22%20style=%22width:60px;%20padding:3px;%20margin-bottom:0;%22%3E%20pt%3C/label%3E%3Clabel%20style=%22font-size:12px;%22%3E%E8%A1%8C%E9%AB%98:%20%3Cinput%20type=%22number%22%20id=%22qt-a17-mainLineHeight%22%20value=%22${s.mainLineHeight}%22%20min=%221%22%20max=%223%22%20step=%220.1%22%20class=%22qt-input%22%20style=%22width:60px;%20padding:3px;%20margin-bottom:0;%22%3E%20%E5%80%8D%3C/label%3E%3Clabel%20style=%22font-size:12px;%22%3E%E9%A1%8F%E8%89%B2:%20%3Cinput%20type=%22color%22%20id=%22qt-a17-mainFontColor%22%20value=%22${s.mainFontColor}%22%20style=%22padding:1px;%20height:25px;%20vertical-align:middle;%22%3E%3C/label%3E%3C/div%3E%3C/div%3E%3Cdiv%3E%3Clabel%20style=%22font-weight:bold;%20font-size:13px;%20display:block;%20margin-bottom:5px;%22%3E%E5%8B%95%E6%85%8B%E6%97%A5%E6%9C%9F%E8%A8%AD%E5%AE%9A%20(%E7%9B%B8%E5%B0%8D%E6%96%BC%E4%BB%8A%E5%A4%A9)%EF%BC%9A%3C/label%3E%3Cdiv%20style=%22display:flex;%20gap:15px;%20align-items:center;%20margin-bottom:5px;flex-wrap:wrap;%22%3E%3Clabel%20style=%22font-size:12px;%22%3E%E7%94%A2%E6%AA%94%E6%99%82%E9%96%93%E5%81%8F%E7%A7%BB:%20%3Cinput%20type=%22number%22%20id=%22qt-a17-genDateOffset%22%20value=%22${s.genDateOffset}%22%20class=%22qt-input%22%20style=%22width:60px;%20padding:3px;%20margin-bottom:0;%22%3E%20%E5%A4%A9%3C/label%3E%3Clabel%20style=%22font-size:12px;%22%3E%E6%AF%94%E5%B0%8D%E6%99%82%E9%96%93%E5%81%8F%E7%A7%BB:%20%3Cinput%20type=%22number%22%20id=%22qt-a17-compDateOffset%22%20value=%22${s.compDateOffset}%22%20class=%22qt-input%22%20style=%22width:60px;%20padding:3px;%20margin-bottom:0;%22%3E%20%E5%A4%A9%3C/label%3E%3C/div%3E%3Cdiv%20style=%22display:flex;%20gap:10px;%20flex-wrap:wrap;%22%3E%3Clabel%20style=%22font-size:12px;%22%3E%E6%97%A5%E6%9C%9F%E5%AD%97%E9%AB%94%E5%A4%A7%E5%B0%8F:%20%3Cinput%20type=%22number%22%20id=%22qt-a17-dateFontSize%22%20value=%22${s.dateFontSize}%22%20min=%226%22%20max=%2216%22%20step=%220.5%22%20class=%22qt-input%22%20style=%22width:60px;%20padding:3px;%20margin-bottom:0;%22%3E%20pt%3C/label%3E%3Clabel%20style=%22font-size:12px;%22%3E%E6%97%A5%E6%9C%9F%E8%A1%8C%E9%AB%98:%20%3Cinput%20type=%22number%22%20id=%22qt-a17-dateLineHeight%22%20value=%22${s.dateLineHeight}%22%20min=%221%22%20max=%223%22%20step=%220.1%22%20class=%22qt-input%22%20style=%22width:60px;%20padding:3px;%20margin-bottom:0;%22%3E%20%E5%80%8D%3C/label%3E%3Clabel%20style=%22font-size:12px;%22%3E%E6%97%A5%E6%9C%9F%E9%A1%8F%E8%89%B2:%20%3Cinput%20type=%22color%22%20id=%22qt-a17-dateFontColor%22%20value=%22${s.dateFontColor}%22%20style=%22padding:1px;%20height:25px;%20vertical-align:middle;%22%3E%3C/label%3E%3C/div%3E%3C/div%3E%3Cdiv%3E%3Clabel%20style=%22font-weight:bold;%20font-size:13px;%20display:block;%20margin-bottom:5px;%22%3E%E9%A0%90%E8%A6%BD%E6%95%88%E6%9E%9C%20(%E6%AD%A4%E5%8D%80%E5%8F%AF%E8%87%A8%E6%99%82%E7%B7%A8%E8%BC%AF%EF%BC%8C%E5%83%85%E5%BD%B1%E9%9F%BF%E7%95%B6%E6%AC%A1%E8%A4%87%E8%A3%BD)%EF%BC%9A%3C/label%3E%3Cdiv%20id=%22qt-a17-preview%22%20contenteditable=%22true%22%20style=%22border:1px%20solid%20#ccc;%20padding:10px;%20min-height:100px;%20max-height:200px;%20overflow-y:auto;%20font-size:${s.mainFontSize}pt;%20line-height:${s.mainLineHeight};%20color:${s.mainFontColor};%20background:#f9f9f9;%20border-radius:4px;%22%3E%3C/div%3E%3C/div%3E%3C/div%3E%3Cdiv%20class=%22qt-dialog-flex-between%22%20style=%22margin-top:20px;%22%3E%3Cbutton%20id=%22qt-a17-text-reset%22%20class=%22qt-dialog-btn%20qt-dialog-btn-orange%22%3E%E9%87%8D%E8%A8%AD%E9%A0%90%E8%A8%AD%3C/button%3E%3Cdiv%3E%3Cbutton%20id=%22qt-a17-text-cancel%22%20class=%22qt-dialog-btn%20qt-dialog-btn-grey%22%3E%E5%8F%96%E6%B6%88%3C/button%3E%3Cbutton%20id=%22qt-a17-text-save%22%20class=%22qt-dialog-btn%20qt-dialog-btn-blue%22%3E%E5%84%B2%E5%AD%98%E8%A8%AD%E5%AE%9A%3C/button%3E%3C/div%3E%3C/div%3E%60;const{overlay,dialog}=createDialogBase('_A17TextSettings',contentHtml,'550px','auto');const%20previewEl=overlay.querySelector('#qt-a17-preview');const%20getSettingsFromUI=()=%3E({mainContent:overlay.querySelector('#qt-a17-mainContent').value,mainFontSize:parseFloat(overlay.querySelector('#qt-a17-mainFontSize').value),mainLineHeight:parseFloat(overlay.querySelector('#qt-a17-mainLineHeight').value),mainFontColor:overlay.querySelector('#qt-a17-mainFontColor').value,dateFontSize:parseFloat(overlay.querySelector('#qt-a17-dateFontSize').value),dateLineHeight:parseFloat(overlay.querySelector('#qt-a17-dateLineHeight').value),dateFontColor:overlay.querySelector('#qt-a17-dateFontColor').value,genDateOffset:parseInt(overlay.querySelector('#qt-a17-genDateOffset').value),compDateOffset:parseInt(overlay.querySelector('#qt-a17-compDateOffset').value)});const%20updatePreview=()=%3E{const%20currentUISettings=getSettingsFromUI();const%20today=new%20Date();const%20genDate=new%20Date(today);genDate.setDate(today.getDate()+currentUISettings.genDateOffset);const%20compDate=new%20Date(today);compDate.setDate(today.getDate()+currentUISettings.compDateOffset);const%20genDateStr=formatDate(genDate);const%20compDateStr=formatDate(compDate);let%20previewContent=escapeHtml(currentUISettings.mainContent).replace(/\n/g,'%3Cbr%3E')+%60%3Cbr%3E%3Cbr%3E%3Cspan%20class=%22qt-a17-dynamic-date%22%20style=%22font-size:${currentUISettings.dateFontSize}pt;%20line-height:${currentUISettings.dateLineHeight};%20color:${currentUISettings.dateFontColor};%22%3E%E7%94%A2%E6%AA%94%E6%99%82%E9%96%93%EF%BC%9A${genDateStr}%3Cbr%3E%E6%AF%94%E5%B0%8D%E6%99%82%E9%96%93%EF%BC%9A${compDateStr}%3C/span%3E%60;previewEl.innerHTML=previewContent;previewEl.style.fontSize=currentUISettings.mainFontSize+'pt';previewEl.style.lineHeight=currentUISettings.mainLineHeight;previewEl.style.color=currentUISettings.mainFontColor};['#qt-a17-mainContent','#qt-a17-mainFontSize','#qt-a17-mainLineHeight','#qt-a17-mainFontColor','#qt-a17-dateFontSize','#qt-a17-dateLineHeight','#qt-a17-dateFontColor','#qt-a17-genDateOffset','#qt-a17-compDateOffset'].forEach(selector=%3E{const%20el=overlay.querySelector(selector);if(el.type==='color')el.onchange=updatePreview;else%20el.oninput=updatePreview});updatePreview();const%20closeDialog=(value)=%3E{overlay.remove();document.removeEventListener('keydown',escListener);resolve(value)};const%20escListener=(e)=%3E{if(e.key==='Escape')closeDialog(null);};document.addEventListener('keydown',escListener);overlay.querySelector('#qt-a17-text-save').onclick=()=%3E{const%20newSettings=getSettingsFromUI();if(!newSettings.mainContent.trim()){displaySystemNotification('%E4%B8%BB%E6%96%87%E6%A1%88%E5%85%A7%E5%AE%B9%E4%B8%8D%E5%8F%AF%E7%82%BA%E7%A9%BA',!0);return}a17ModeState.textSettings=newSettings;localStorage.setItem(A17_TEXT_SETTINGS_STORAGE_KEY,JSON.stringify(newSettings));displaySystemNotification('A17%E6%96%87%E6%9C%AC%E8%A8%AD%E5%AE%9A%E5%B7%B2%E5%84%B2%E5%AD%98',!1);closeDialog(!0)};overlay.querySelector('#qt-a17-text-cancel').onclick=()=%3EcloseDialog(null);overlay.querySelector('#qt-a17-text-reset').onclick=()=%3E{overlay.querySelector('#qt-a17-mainContent').value=A17_DEFAULT_TEXT_CONTENT;overlay.querySelector('#qt-a17-mainFontSize').value=12;overlay.querySelector('#qt-a17-mainLineHeight').value=1.5;overlay.querySelector('#qt-a17-mainFontColor').value='#333333';overlay.querySelector('#qt-a17-dateFontSize').value=8;overlay.querySelector('#qt-a17-dateLineHeight').value=1.2;overlay.querySelector('#qt-a17-dateFontColor').value='#555555';overlay.querySelector('#qt-a17-genDateOffset').value=-3;overlay.querySelector('#qt-a17-compDateOffset').value=0;updatePreview()}})}async%20function%20performApiQuery(queryValue,apiKey){const%20reqBody={currentPage:1,pageSize:10};reqBody[apiKey]=queryValue;const%20fetchOpts={method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(reqBody),};if(apiAuthToken)fetchOpts.headers['SSO-TOKEN']=apiAuthToken;let%20retries=1;while(retries%3E=0){try{const%20res=await%20fetch(CURRENT_API_URL,fetchOpts);const%20data=await%20res.json();if(res.status===401){apiAuthToken=null;localStorage.removeItem(TOKEN_STORAGE_KEY);return{error:'token_invalid',data:null}}if(!res.ok){throw%20new%20Error(%60API%E8%AB%8B%E6%B1%82%E9%8C%AF%E8%AA%A4:%20${res.status}%20${res.statusText}%60)}return{error:null,data:data,success:data&&data.records&&data.records.length%3E0}}catch(e){console.error(%60%E6%9F%A5%E8%A9%A2%20${queryValue}%20%E9%8C%AF%E8%AA%A4%20(%E5%98%97%E8%A9%A6%20${2-retries}):%60,e);if(retries%3E0){displaySystemNotification(%60%E6%9F%A5%E8%A9%A2%20${queryValue}%20%E5%A4%B1%E6%95%97%EF%BC%8C2%E7%A7%92%E5%BE%8C%E9%87%8D%E8%A9%A6...%60,!0,1800);await%20new%20Promise(r=%3EsetTimeout(r,2000));retries--}else{return{error:'network_error',data:null}}}}}function%20renderResultsTableUI(dataToRender){currentTableInstance.mainUIElement?.remove();document.removeEventListener('keydown',mainUIEscListener);const%20mainUI=document.createElement('div');currentTableInstance.mainUIElement=mainUI;mainUI.id=TOOL_MAIN_CONTAINER_ID;mainUI.style.cssText=%60position:fixed;z-index:${Z_INDEX_MAIN_UI};left:50%;top:50%;transform:translate(-50%,-50%);background:#f8f9fa;border-radius:10px;box-shadow:0%208px%2030px%20rgba(0,0,0,0.15);padding:0;width:auto;max-width:850px;max-height:90vh;display:flex;flex-direction:column;font-family:'Microsoft%20JhengHei',Arial,sans-serif;font-size:13px;border:1px%20solid%20#dee2e6;user-select:none;%60;const%20titleBar=document.createElement('div');titleBar.textContent='%E5%87%B1%E5%9F%BA%E4%BA%BA%E5%A3%BD%E6%A1%88%E4%BB%B6%E6%9F%A5%E8%A9%A2%E7%B5%90%E6%9E%9C';titleBar.style.cssText=%60padding:10px%2015px;margin:-0px%20-0px%2010px%20-0px;background-color:#343a40;color:white;font-weight:bold;font-size:14px;text-align:center;border-top-left-radius:9px;border-top-right-radius:9px;cursor:grab;user-select:none;%60;mainUI.appendChild(titleBar);const%20contentWrapper=document.createElement('div');contentWrapper.style.cssText='padding:15px;%20overflow-y:auto;%20display:flex;%20flex-direction:column;%20flex-grow:1;';mainUI.appendChild(contentWrapper);const%20controlsHeader=document.createElement('div');controlsHeader.style.cssText=%60display:flex;align-items:center;justify-content:space-between;margin-bottom:10px;padding-bottom:10px;border-bottom:1px%20solid%20#e0e0e0;flex-wrap:wrap;gap:8px;%60;const%20summarySec=document.createElement('div');summarySec.id=TOOL_MAIN_CONTAINER_ID+'_SummarySection';summarySec.style.cssText='font-size:13px;font-weight:bold;color:#2c3e50;white-space:nowrap;';controlsHeader.appendChild(summarySec);const%20filterInput=document.createElement('input');filterInput.type='text';filterInput.id=TOOL_MAIN_CONTAINER_ID+'_TableFilterInput';filterInput.placeholder='%E7%AF%A9%E9%81%B8%E8%A1%A8%E6%A0%BC%E5%85%A7%E5%AE%B9...';filterInput.className='qt-input';filterInput.style.width='180px';filterInput.style.marginBottom='0';const%20buttonsGroupLeft=document.createElement('div');buttonsGroupLeft.style.cssText='display:flex;gap:6px;align-items:center;';const%20buttonsGroupRight=document.createElement('div');buttonsGroupRight.style.cssText='display:flex;gap:6px;align-items:center;margin-left:auto;';[{id:'ClearConditions',text:'%E6%B8%85%E9%99%A4%E6%A2%9D%E4%BB%B6',cls:'qt-dialog-btn-grey',group:buttonsGroupLeft},{id:'Requery',text:'%E9%87%8D%E6%96%B0%E6%9F%A5%E8%A9%A2',cls:'qt-dialog-btn-orange',group:buttonsGroupLeft},{id:'A17',text:'A17%E4%BD%9C%E6%A5%AD',cls:'qt-dialog-btn-purple',group:buttonsGroupLeft},{id:'CopyTable',text:'%E8%A4%87%E8%A3%BD%E8%A1%A8%E6%A0%BC',cls:'qt-dialog-btn-green',group:buttonsGroupLeft},{id:'EditMode',text:'%E7%B7%A8%E8%BC%AF%E6%A8%A1%E5%BC%8F',cls:'qt-dialog-btn-blue',group:buttonsGroupLeft},{id:'AddRow',text:'+%20%E6%96%B0%E5%A2%9E%E5%88%97',cls:'qt-dialog-btn-blue',group:buttonsGroupLeft,style:'display:none;'}].forEach(cfg=%3E{const%20btn=document.createElement('button');btn.id=TOOL_MAIN_CONTAINER_ID+'_btn'+cfg.id;btn.textContent=cfg.text;btn.className=%60qt-dialog-btn%20${cfg.cls}%60;if(cfg.style)btn.style.cssText+=cfg.style;cfg.group.appendChild(btn)});const%20closeBtn=document.createElement('button');closeBtn.id=TOOL_MAIN_CONTAINER_ID+'_btnCloseTool';closeBtn.textContent='%E9%97%9C%E9%96%89%E5%B7%A5%E5%85%B7';closeBtn.className='qt-dialog-btn%20qt-dialog-btn-red';buttonsGroupRight.appendChild(closeBtn);controlsHeader.appendChild(filterInput);controlsHeader.appendChild(buttonsGroupLeft);controlsHeader.appendChild(buttonsGroupRight);contentWrapper.appendChild(controlsHeader);const%20a17UnitBtnsCtr=document.createElement('div');a17UnitBtnsCtr.id=TOOL_MAIN_CONTAINER_ID+'_A17UnitBtns';a17UnitBtnsCtr.style.cssText='margin-bottom:10px;display:none;flex-wrap:wrap;gap:6px;justify-content:flex-start;';contentWrapper.appendChild(a17UnitBtnsCtr);currentTableInstance.a17UnitButtonsContainer=a17UnitBtnsCtr;const%20a17TextControls=document.createElement('div');a17TextControls.id=TOOL_MAIN_CONTAINER_ID+'_A17TextControls';a17TextControls.style.cssText='margin-bottom:10px;display:none;align-items:center;gap:10px;';a17TextControls.innerHTML=%60%3Clabel%20style=%22font-size:12px;color:#333;display:flex;align-items:center;cursor:pointer;%22%3E%3Cinput%20type=%22checkbox%22%20id=%22${TOOL_MAIN_CONTAINER_ID}_cbA17IncludeText%22%20checked%20style=%22margin-right:4px;%22%3EA17%E5%90%AB%E9%80%9A%E7%9F%A5%E6%96%87%3C/label%3E%3Cbutton%20id=%22${TOOL_MAIN_CONTAINER_ID}_btnA17EditText%22%20class=%22qt-dialog-btn%20qt-dialog-btn-blue%22%20style=%22margin-left:0;padding:5px%2010px;font-size:12px;%22%3E%E7%B7%A8%E8%BC%AF%E9%80%9A%E7%9F%A5%E6%96%87%3C/button%3E%60;contentWrapper.appendChild(a17TextControls);const%20tableScrollWrap=document.createElement('div');tableScrollWrap.style.cssText='flex-grow:1;overflow:auto;border:1px%20solid%20#ccc;border-radius:5px;background:white;';const%20tableEl=document.createElement('table');tableEl.id=TOOL_MAIN_CONTAINER_ID+'_ResultsTable';tableEl.style.cssText='width:100%;border-collapse:collapse;font-size:12px;';tableScrollWrap.appendChild(tableEl);contentWrapper.appendChild(tableScrollWrap);const%20tHREl=document.createElement('thead');tHREl.style.cssText='position:sticky;top:0;z-index:1;background-color:#343a40;color:white;';tableEl.appendChild(tHREl);currentTableInstance.tableHeadElement=tHREl;const%20tBREl=document.createElement('tbody');tableEl.appendChild(tBREl);currentTableInstance.tableBodyElement=tBREl;document.body.appendChild(mainUI);titleBar.onmousedown=(e)=%3E{if(e.target!==titleBar)return;e.preventDefault();dragState.dragging=!0;dragState.startX=e.clientX;dragState.startY=e.clientY;dragState.initialX=mainUI.offsetLeft;dragState.initialY=mainUI.offsetTop;titleBar.style.cursor='grabbing';mainUI.style.transform='none'};document.onmousemove=(e)=%3E{if(dragState.dragging){const%20dx=e.clientX-dragState.startX;const%20dy=e.clientY-dragState.startY;mainUI.style.left=(dragState.initialX+dx)+'px';mainUI.style.top=(dragState.initialY+dy)+'px'}};document.onmouseup=()=%3E{if(dragState.dragging){dragState.dragging=!1;titleBar.style.cursor='grab'}};filterInput.oninput=()=%3EapplyTableFilter();mainUI.querySelector(%60#${TOOL_MAIN_CONTAINER_ID}_btnClearConditions%60).onclick=handleClearConditions;mainUI.querySelector(%60#${TOOL_MAIN_CONTAINER_ID}_btnRequery%60).onclick=()=%3E{mainUI.remove();document.removeEventListener('keydown',mainUIEscListener);executeCaseQueryTool()};const%20a17Btn=mainUI.querySelector(%60#${TOOL_MAIN_CONTAINER_ID}_btnA17%60);a17Btn.onmousedown=(e)=%3E{if(e.button!==0)return;a17ButtonLongPressTimer=setTimeout(()=%3E{a17ButtonLongPressTimer=null;toggleA17Mode(!0)},700)};a17Btn.onmouseup=()=%3E{if(a17ButtonLongPressTimer){clearTimeout(a17ButtonLongPressTimer);a17ButtonLongPressTimer=null;toggleA17Mode(!1)}};a17Btn.onmouseleave=()=%3E{if(a17ButtonLongPressTimer){clearTimeout(a17ButtonLongPressTimer);a17ButtonLongPressTimer=null}};mainUI.querySelector(%60#${TOOL_MAIN_CONTAINER_ID}_btnCopyTable%60).onclick=handleCopyTable;mainUI.querySelector(%60#${TOOL_MAIN_CONTAINER_ID}_btnEditMode%60).onclick=toggleEditMode;mainUI.querySelector(%60#${TOOL_MAIN_CONTAINER_ID}_btnAddRow%60).onclick=handleAddRowToTable;closeBtn.onclick=()=%3E{mainUI.remove();document.removeEventListener('keydown',mainUIEscListener)};mainUI.querySelector(%60#${TOOL_MAIN_CONTAINER_ID}_btnA17EditText%60).onclick=async()=%3E{await%20createA17TextSettingDialog()};document.addEventListener('keydown',mainUIEscListener);updateSummaryCount(dataToRender.length);if(currentTableInstance.isA17Mode){renderA17ModeUI();populateTableRows(baseA17MasterData);updateA17UnitButtonCounts()}else{renderNormalModeUI();populateTableRows(dataToRender)}}const%20mainUIEscListener=(e)=%3E{if(e.key==='Escape'&&currentTableInstance.mainUIElement&&!document.querySelector(%60[id^=%22${TOOL_MAIN_CONTAINER_ID}_%22][id$=%22_overlay%22]%60)){currentTableInstance.mainUIElement.remove();document.removeEventListener('keydown',mainUIEscListener)}};function%20updateSummaryCount(visibleRowCount){const%20summaryEl=currentTableInstance.mainUIElement?.querySelector(%60#${TOOL_MAIN_CONTAINER_ID}_SummarySection%60);if(!summaryEl)return;let%20baseDataCount=currentTableInstance.isA17Mode?baseA17MasterData.length:originalQueryResults.length;let%20text=%60%E6%9F%A5%E8%A9%A2%E7%B5%90%E6%9E%9C%EF%BC%9A%3Cstrong%3E${baseDataCount}%3C/strong%3E%E7%AD%86%60;const%20filterInput=currentTableInstance.mainUIElement.querySelector(%60#${TOOL_MAIN_CONTAINER_ID}_TableFilterInput%60);const%20isFiltered=(filterInput&&filterInput.value.trim()!=='')||(currentTableInstance.isA17Mode&&a17ModeState.selectedUnits.size%3E0);if(isFiltered&&visibleRowCount!==baseDataCount){text+=%60%20(%E7%AF%A9%E9%81%B8%E5%BE%8C%E9%A1%AF%E7%A4%BA%20%3Cstrong%3E${visibleRowCount}%3C/strong%3E%20%E7%AD%86)%60}summaryEl.innerHTML=text}function%20renderTableHeaders(headers){currentTableInstance.tableHeadElement.innerHTML='';const%20hr=document.createElement('tr');headers.forEach((hTxt,idx)=%3E{const%20th=document.createElement('th');th.textContent=escapeHtml(hTxt);th.style.cssText=%60padding:%208px%206px;%20text-align:center;%20white-space:nowrap;%20cursor:pointer;%20user-select:none;%20font-weight:600;%20font-size:12px;%20border-right:%201px%20solid%20#4a6075;%60;if(idx===headers.length-1)th.style.borderRight='none';if(idx===0&&!currentTableInstance.isA17Mode)th.style.backgroundColor='#007bff';th.onclick=()=%3EsortTableByColumn(hTxt);hr.appendChild(th)});if(isEditMode){const%20thAction=document.createElement('th');thAction.textContent=%22%E6%93%8D%E4%BD%9C%22;thAction.style.cssText=%60padding:%208px%206px;%20text-align:center;%20white-space:nowrap;%20font-weight:600;%20font-size:12px;%60;hr.appendChild(thAction)}currentTableInstance.tableHeadElement.appendChild(hr);currentTableInstance.currentHeaders=headers}function%20populateTableRows(data){currentTableInstance.tableBodyElement.innerHTML='';data.forEach((row,rowIndex)=%3E{const%20tr=document.createElement('tr');tr.style.backgroundColor=rowIndex%2?'#f8f9fa':'#ffffff';tr.onmouseover=()=%3E{if(!tr.classList.contains('qt-editing-row'))tr.style.backgroundColor='#e9ecef'};tr.onmouseout=()=%3E{if(!tr.classList.contains('qt-editing-row'))tr.style.backgroundColor=rowIndex%2?'#f8f9fa':'#ffffff'};currentTableInstance.currentHeaders.forEach((headerKey,colIndex)=%3E{const%20td=document.createElement('td');td.style.cssText='padding:6px;%20border-bottom:1px%20solid%20#dee2e6;%20font-size:12px;%20text-align:center;%20border-right:1px%20solid%20#dee2e6;';if(colIndex===currentTableInstance.currentHeaders.length-1)td.style.borderRight='none';let%20cellValue=row[headerKey]===null||row[headerKey]===undefined?'':String(row[headerKey]);if(headerKey===FIELD_DISPLAY_NAMES_MAP.statusCombined&&typeof%20cellValue==='string'&&cellValue.includes('%3Cspan')){td.innerHTML=cellValue}else{td.textContent=cellValue}if(currentTableInstance.isA17Mode&&headerKey===FIELD_DISPLAY_NAMES_MAP.uwApproverUnit){td.style.backgroundColor='#e6f7ff';td.style.fontWeight='500'}if(isEditMode&&((colIndex%3E1&&!row._isNewRow)||(row._isNewRow&&headerKey!==%22%E6%93%8D%E4%BD%9C%22))&&headerKey!==FIELD_DISPLAY_NAMES_MAP._apiQueryStatus){td.onclick=(e)=%3E{if(e.target.tagName!=='INPUT'&&e.target.tagName!=='SELECT')startCellEdit(td,row,headerKey,rowIndex);}}else%20if(!isEditMode){td.onclick=()=%3E{navigator.clipboard.writeText(td.textContent||td.innerText).then(()=%3EdisplaySystemNotification(%60%E5%B7%B2%E8%A4%87%E8%A3%BD:%20${td.textContent%20||%20td.innerText}%60,!1,1000)).catch(err=%3EdisplaySystemNotification('%E8%A4%87%E8%A3%BD%E5%A4%B1%E6%95%97',!0))}}tr.appendChild(td)});if(isEditMode){const%20tdAction=document.createElement('td');tdAction.style.cssText='padding:6px;%20border-bottom:1px%20solid%20#dee2e6;%20text-align:center;';const%20deleteBtn=document.createElement('button');deleteBtn.innerHTML='&#x1F5D1;';deleteBtn.className='qt-dialog-btn%20qt-dialog-btn-red';deleteBtn.style.padding='3px%206px';deleteBtn.style.fontSize='10px';deleteBtn.onclick=()=%3EhandleDeleteRow(rowIndex);tdAction.appendChild(deleteBtn);tr.appendChild(tdAction)}currentTableInstance.tableBodyElement.appendChild(tr)});updateSummaryCount(data.length)}function%20sortTableByColumn(headerKeyToSortBy){const%20currentData=currentTableInstance.isA17Mode?[...baseA17MasterData]:[...originalQueryResults];if(currentData.length===0)return;const%20direction=(currentTableInstance.sortDirections[headerKeyToSortBy]||'desc')==='asc'?'desc':'asc';currentTableInstance.sortDirections={};currentTableInstance.sortDirections[headerKeyToSortBy]=direction;currentData.sort((a,b)=%3E{let%20valA=a[headerKeyToSortBy]===null||a[headerKeyToSortBy]===undefined?'':String(a[headerKeyToSortBy]);let%20valB=b[headerKeyToSortBy]===null||b[headerKeyToSortBy]===undefined?'':String(b[headerKeyToSortBy]);const%20isNumeric=headerKeyToSortBy===FIELD_DISPLAY_NAMES_MAP.NO||(!isNaN(parseFloat(valA))&&isFinite(valA)&&!isNaN(parseFloat(valB))&&isFinite(valB)&&valA.trim()!==''&&valB.trim()!=='');let%20comparison=0;if(isNumeric){comparison=parseFloat(valA)-parseFloat(valB)}else{comparison=valA.localeCompare(valB,'zh-Hant-TW')}return%20direction==='asc'?comparison:-comparison});if(currentTableInstance.isA17Mode)baseA17MasterData=currentData;else%20originalQueryResults=currentData;populateTableRows(currentData);displaySystemNotification(%60%E5%B7%B2%E6%8C%89%E3%80%8C${headerKeyToSortBy}%E3%80%8D${direction%20===%20'asc'%20?%20'%E5%8D%87%E5%BA%8F'%20:%20'%E9%99%8D%E5%BA%8F'}%E6%8E%92%E5%88%97%60,!1);currentTableInstance.tableHeadElement.querySelectorAll('th').forEach(th=%3E{const%20currentHeaderText=th.textContent.replace(/[\u25B2\u25BC\s]*$/,'').trim();th.innerHTML=escapeHtml(currentHeaderText);if(currentHeaderText===headerKeyToSortBy){th.innerHTML+=(direction==='asc'?'%20%3Cspan%20style=%22font-size:10px;%22%3E\u25B2%3C/span%3E':'%20%3Cspan%20style=%22font-size:10px;%22%3E\u25BC%3C/span%3E')}})}function%20applyTableFilter(){const%20filterText=currentTableInstance.mainUIElement.querySelector(%60#${TOOL_MAIN_CONTAINER_ID}_TableFilterInput%60).value.trim().toLowerCase();const%20baseData=currentTableInstance.isA17Mode?baseA17MasterData:originalQueryResults;let%20filteredData=baseData;if(filterText){filteredData=baseData.filter(row=%3EcurrentTableInstance.currentHeaders.some(headerKey=%3E(String(row[headerKey]||'').toLowerCase().includes(filterText))))}if(currentTableInstance.isA17Mode&&a17ModeState.selectedUnits.size%3E0){let%20unitFilteredData=[];a17ModeState.selectedUnits.forEach(unitId=%3E{unitFilteredData=unitFilteredData.concat(filteredData.filter(row=%3E{const%20unitVal=String(row[FIELD_DISPLAY_NAMES_MAP[UNIT_MAP_FIELD_API_KEY]]||'');if(unitId==='UNDEF'){const%20knownPrefixes=A17_UNIT_BUTTONS_DEFS.filter(b=%3Eb.id!=='UNDEF').map(b=%3Eb.id.toUpperCase());return%20unitVal.trim()===''||!knownPrefixes.some(prefix=%3EunitVal.toUpperCase().startsWith(prefix))}return%20unitVal.toUpperCase().startsWith(unitId.toUpperCase())}))});filteredData=Array.from(new%20Set(unitFilteredData.map(JSON.stringify))).map(JSON.parse)}populateTableRows(filteredData)}function%20handleClearConditions(){currentTableInstance.mainUIElement.querySelector(%60#${TOOL_MAIN_CONTAINER_ID}_TableFilterInput%60).value='';currentTableInstance.sortDirections={};if(currentTableInstance.isA17Mode){a17ModeState.selectedUnits.clear();currentTableInstance.a17UnitButtonsContainer.querySelectorAll('button.highlighted').forEach(btn=%3E{btn.classList.remove('highlighted');btn.style.boxShadow='none'});csvImportState={fileName:'',rawHeaders:[],rawData:[],selectedColForQueryName:null,selectedColsForA17Merge:[],isA17CsvPrepared:!1};baseA17MasterData=[...originalQueryResults];baseA17MasterData.sort((a,b)=%3E(parseInt(a[FIELD_DISPLAY_NAMES_MAP.NO])||0)-(parseInt(b[FIELD_DISPLAY_NAMES_MAP.NO])||0));populateTableRows(baseA17MasterData);updateA17UnitButtonCounts()}else{originalQueryResults.sort((a,b)=%3E(parseInt(a[FIELD_DISPLAY_NAMES_MAP.NO])||0)-(parseInt(b[FIELD_DISPLAY_NAMES_MAP.NO])||0));populateTableRows(originalQueryResults)}renderTableHeaders(currentTableInstance.currentHeaders);displaySystemNotification('%E6%89%80%E6%9C%89%E6%A2%9D%E4%BB%B6%E5%B7%B2%E6%B8%85%E9%99%A4%EF%BC%8C%E8%A1%A8%E6%A0%BC%E5%B7%B2%E9%87%8D%E7%BD%AE%E7%82%BA%E6%8C%89%E5%BA%8F%E8%99%9F%E6%8E%92%E5%BA%8F',!1)}function%20toggleEditMode(){isEditMode=!isEditMode;const%20editBtn=currentTableInstance.mainUIElement.querySelector(%60#${TOOL_MAIN_CONTAINER_ID}_btnEditMode%60);const%20addRowBtn=currentTableInstance.mainUIElement.querySelector(%60#${TOOL_MAIN_CONTAINER_ID}_btnAddRow%60);editBtn.textContent=isEditMode?'%E5%AE%8C%E6%88%90%E7%B7%A8%E8%BC%AF':'%E7%B7%A8%E8%BC%AF%E6%A8%A1%E5%BC%8F';editBtn.className=%60qt-dialog-btn%20${isEditMode%20?%20'qt-dialog-btn-red'%20:%20'qt-dialog-btn-blue'}%60;addRowBtn.style.display=isEditMode?'inline-block':'none';const%20currentData=currentTableInstance.isA17Mode?baseA17MasterData:originalQueryResults;renderTableHeaders(currentTableInstance.currentHeaders);populateTableRows(currentData);displaySystemNotification(isEditMode?'%E5%B7%B2%E9%80%B2%E5%85%A5%E7%B7%A8%E8%BC%AF%E6%A8%A1%E5%BC%8F':'%E5%B7%B2%E9%80%80%E5%87%BA%E7%B7%A8%E8%BC%AF%E6%A8%A1%E5%BC%8F',!1)}function%20startCellEdit(td,rowData,headerKey,rowIndex){if(td.querySelector('input,%20select'))return;td.classList.add('qt-editing-cell');const%20originalText=td.textContent;td.innerHTML='';let%20inputElement;if(isEditMode&&currentTableInstance.isA17Mode&&headerKey===FIELD_DISPLAY_NAMES_MAP.uwApproverUnit){inputElement=document.createElement('select');inputElement.className='qt-input';inputElement.style.cssText='width:100%;padding:4px;font-size:12px;border:1px%20solid%20#007bff;margin:0;background:transparent;';const%20defaultOption=document.createElement('option');defaultOption.value=%22%22;defaultOption.textContent=%22--%E9%81%B8%E6%93%87%E5%88%86%E5%85%AC%E5%8F%B8--%22;inputElement.appendChild(defaultOption);A17_UNIT_BUTTONS_DEFS.forEach(unitDef=%3E{if(unitDef.id==='UNDEF')return;const%20option=document.createElement('option');option.value=unitDef.id;option.textContent=unitDef.label;const%20currentUnitPrefix=String(rowData[headerKey]||'').split('-')[0].toUpperCase();if(unitDef.id===currentUnitPrefix)option.selected=!0;inputElement.appendChild(option)});inputElement.onchange=()=%3EfinishCellEdit(td,inputElement,rowData,headerKey,originalText,rowIndex,'select')}else{inputElement=document.createElement('input');inputElement.type='text';inputElement.className='qt-input';inputElement.style.cssText='width:100%;padding:4px;font-size:12px;border:1px%20solid%20#007bff;margin:0;';inputElement.value=originalText;inputElement.onkeydown=(e)=%3E{if(e.key==='Enter'){e.preventDefault();finishCellEdit(td,inputElement,rowData,headerKey,originalText,rowIndex,'input')}else%20if(e.key==='Escape'){td.textContent=originalText;td.classList.remove('qt-editing-cell')}}}inputElement.onblur=()=%3E{setTimeout(()=%3E{if(td.contains(inputElement))finishCellEdit(td,inputElement,rowData,headerKey,originalText,rowIndex,inputElement.tagName.toLowerCase());},100)};td.appendChild(inputElement);inputElement.focus();if(inputElement.select)inputElement.select();}function%20finishCellEdit(td,inputElement,rowData,headerKey,originalText,rowIndex,inputType='input'){const%20newValue=inputElement.value.trim();td.classList.remove('qt-editing-cell');const%20displayValue=(inputType==='select'&&newValue)?A17_UNIT_BUTTONS_DEFS.find(def=%3Edef.id===newValue)?.label||newValue:newValue;td.textContent=displayValue;if(newValue!==originalText||(inputType==='select'&&(rowData[headerKey]||'').split('-')[0]!==newValue)){rowData[headerKey]=displayValue;displaySystemNotification(%60%E3%80%8C${headerKey}%E3%80%8D%E5%B7%B2%E6%9B%B4%E6%96%B0%60,!1,1500);td.style.backgroundColor='#d4edda';if(currentTableInstance.isA17Mode&&headerKey===FIELD_DISPLAY_NAMES_MAP.uwApproverUnit){updateA17UnitButtonCounts();if(a17ModeState.selectedUnits.size%3E0)applyTableFilter();}}else{td.textContent=originalText}}function%20handleAddRowToTable(){if(!isEditMode){displaySystemNotification('%E8%AB%8B%E5%85%88%E9%80%B2%E5%85%A5%E7%B7%A8%E8%BC%AF%E6%A8%A1%E5%BC%8F',!0);return}const%20newRow={_isNewRow:!0};let%20maxNo=0;const%20targetDataset=currentTableInstance.isA17Mode?baseA17MasterData:originalQueryResults;targetDataset.forEach(row=%3E{const%20currentNo=parseInt(row[FIELD_DISPLAY_NAMES_MAP.NO]);if(!isNaN(currentNo)&&currentNo%3EmaxNo)maxNo=currentNo});newRow[FIELD_DISPLAY_NAMES_MAP.NO]=String(maxNo+1);currentTableInstance.currentHeaders.forEach(header=%3E{if(header!==FIELD_DISPLAY_NAMES_MAP.NO&&header!==%22%E6%93%8D%E4%BD%9C%22)newRow[header]=''});if(currentTableInstance.isA17Mode){baseA17MasterData.push(newRow);populateTableRows(baseA17MasterData)}else{originalQueryResults.push(newRow);populateTableRows(originalQueryResults)}displaySystemNotification('%E5%B7%B2%E6%96%B0%E5%A2%9E%E4%B8%80%E5%88%97%EF%BC%8C%E8%AB%8B%E7%B7%A8%E8%BC%AF%E5%85%A7%E5%AE%B9',!1);const%20tableWrapper=currentTableInstance.mainUIElement.querySelector(%60#${TOOL_MAIN_CONTAINER_ID}_TableScrollWrapper%60);if(tableWrapper)tableWrapper.scrollTop=tableWrapper.scrollHeight}function%20handleDeleteRow(rowIndex){if(!isEditMode)return;const%20targetDataset=currentTableInstance.isA17Mode?baseA17MasterData:originalQueryResults;if(rowIndex%3E=0&&rowIndex%3CtargetDataset.length){targetDataset.splice(rowIndex,1);populateTableRows(targetDataset);displaySystemNotification('%E5%B7%B2%E5%88%AA%E9%99%A4%E8%A9%B2%E5%88%97%E8%B3%87%E6%96%99',!1);if(currentTableInstance.isA17Mode)updateA17UnitButtonCounts();}}function%20loadA17TextSettings(){const%20saved=localStorage.getItem(A17_TEXT_SETTINGS_STORAGE_KEY);if(saved){try{const%20parsed=JSON.parse(saved);for(const%20key%20in%20a17ModeState.textSettings){if(parsed.hasOwnProperty(key))a17ModeState.textSettings[key]=parsed[key]}}catch(e){console.error(%22%E8%BC%89%E5%85%A5A17%E6%96%87%E6%9C%AC%E8%A8%AD%E5%AE%9A%E5%A4%B1%E6%95%97:%22,e)}}}function%20toggleA17Mode(forceEnter=!1){const%20a17TextControls=currentTableInstance.mainUIElement.querySelector(%60#${TOOL_MAIN_CONTAINER_ID}_A17TextControls%60);if(currentTableInstance.isA17Mode){currentTableInstance.isA17Mode=!1;a17ModeState.isActive=!1;a17ModeState.selectedUnits.clear();currentTableInstance.a17UnitButtonsContainer.style.display='none';a17TextControls.style.display='none';renderNormalModeUI();populateTableRows(originalQueryResults);displaySystemNotification('%E5%B7%B2%E9%80%80%E5%87%BAA17%E4%BD%9C%E6%A5%AD%E6%A8%A1%E5%BC%8F',!1)}else{if(!forceEnter&&!csvImportState.isA17CsvPrepared){displaySystemNotification('%E8%AB%8B%E5%85%88%E9%80%8F%E9%81%8E%E3%80%8C%E5%8C%AF%E5%85%A5CSV/TXT%E3%80%8D%E6%8C%89%E9%88%95%E9%81%B8%E6%93%87%E3%80%8C%E5%8B%BE%E9%81%B8CSV%E6%AC%84%E4%BD%8D%E4%BE%9BA17%E5%90%88%E4%BD%B5%E3%80%8D%E4%B8%A6%E5%AE%8C%E6%88%90%E8%A8%AD%E5%AE%9A%E3%80%82%E6%88%96%E9%95%B7%E6%8C%89%E3%80%8CA17%E4%BD%9C%E6%A5%AD%E3%80%8D%E6%8C%89%E9%88%95%E5%BC%B7%E5%88%B6%E9%80%B2%E5%85%A5%E3%80%82',!0,6000);return}currentTableInstance.isA17Mode=!0;a17ModeState.isActive=!0;currentTableInstance.a17UnitButtonsContainer.style.display='flex';a17TextControls.style.display='flex';if(forceEnter&&!csvImportState.isA17CsvPrepared){baseA17MasterData=originalQueryResults.map(row=%3E{const%20newRow={};newRow[FIELD_DISPLAY_NAMES_MAP._queriedValue_]=row[FIELD_DISPLAY_NAMES_MAP._queriedValue_];newRow[FIELD_DISPLAY_NAMES_MAP.NO]=row[FIELD_DISPLAY_NAMES_MAP.NO];ALL_DISPLAY_FIELDS_API_KEYS_MAIN.forEach(apiKey=%3E{const%20displayName=FIELD_DISPLAY_NAMES_MAP[apiKey]||apiKey;if(row.hasOwnProperty(displayName))newRow[displayName]=row[displayName]});newRow[FIELD_DISPLAY_NAMES_MAP._apiQueryStatus]=row[FIELD_DISPLAY_NAMES_MAP._apiQueryStatus];return%20newRow})}else{baseA17MasterData=[];const%20keyCsvHeader=csvImportState.rawHeaders.find(h=%3Eh.includes('%E9%80%81%E9%87%91%E5%96%AE'));const%20keyCsvIndex=keyCsvHeader?csvImportState.rawHeaders.indexOf(keyCsvHeader):(csvImportState.rawHeaders.length%3E0?0:-1);csvImportState.rawData.forEach((csvRowData,index)=%3E{let%20mergedRow={};mergedRow[FIELD_DISPLAY_NAMES_MAP.NO]=String(index+1);csvImportState.selectedColsForA17Merge.forEach(selectedCsvHeader=%3E{const%20originalCsvIndex=csvImportState.rawHeaders.indexOf(selectedCsvHeader);if(originalCsvIndex!==-1)mergedRow[selectedCsvHeader]=csvRowData[originalCsvIndex]});const%20csvKeyValue=(keyCsvIndex!==-1)?csvRowData[keyCsvIndex]:null;let%20apiFound=!1;if(csvKeyValue){const%20matchingApiRow=originalQueryResults.find(apiRow=%3E(apiRow[FIELD_DISPLAY_NAMES_MAP.receiptNumber]===csvKeyValue||apiRow[FIELD_DISPLAY_NAMES_MAP._queriedValue_]===csvKeyValue));if(matchingApiRow){apiFound=!0;ALL_DISPLAY_FIELDS_API_KEYS_MAIN.forEach(apiKey=%3E{const%20displayName=FIELD_DISPLAY_NAMES_MAP[apiKey]||apiKey;if(!mergedRow.hasOwnProperty(displayName)&&matchingApiRow.hasOwnProperty(displayName)){mergedRow[displayName]=matchingApiRow[displayName]}});mergedRow[FIELD_DISPLAY_NAMES_MAP._apiQueryStatus]=matchingApiRow[FIELD_DISPLAY_NAMES_MAP._apiQueryStatus]||'%E2%9C%94%EF%B8%8F%20%E6%88%90%E5%8A%9F'}}if(!apiFound){ALL_DISPLAY_FIELDS_API_KEYS_MAIN.forEach(apiKey=%3E{const%20displayName=FIELD_DISPLAY_NAMES_MAP[apiKey]||apiKey;if(!mergedRow.hasOwnProperty(displayName))mergedRow[displayName]='-'});mergedRow[FIELD_DISPLAY_NAMES_MAP._apiQueryStatus]='%E2%9E%96%20%E7%84%A1%E5%B0%8D%E6%87%89API%E8%B3%87%E6%96%99'}baseA17MasterData.push(mergedRow)})}renderA17ModeUI();populateTableRows(baseA17MasterData);createA17UnitButtons();updateA17UnitButtonCounts();displaySystemNotification('%E5%B7%B2%E9%80%B2%E5%85%A5A17%E4%BD%9C%E6%A5%AD%E6%A8%A1%E5%BC%8F',!1)}}function%20renderNormalModeUI(){let%20headers=[FIELD_DISPLAY_NAMES_MAP._queriedValue_,FIELD_DISPLAY_NAMES_MAP.NO];ALL_DISPLAY_FIELDS_API_KEYS_MAIN.forEach(apiKey=%3E{headers.push(FIELD_DISPLAY_NAMES_MAP[apiKey]||apiKey)});headers.push(FIELD_DISPLAY_NAMES_MAP._apiQueryStatus);renderTableHeaders(headers)}function%20renderA17ModeUI(){let%20headers=[];if(csvImportState.isA17CsvPrepared&&csvImportState.selectedColsForA17Merge.length%3E0){csvImportState.selectedColsForA17Merge.forEach(csvHeader=%3E{if(!headers.includes(csvHeader))headers.push(csvHeader);});ALL_DISPLAY_FIELDS_API_KEYS_MAIN.forEach(apiKey=%3E{const%20displayName=FIELD_DISPLAY_NAMES_MAP[apiKey]||apiKey;if(!headers.includes(displayName))headers.push(displayName);})}else{headers.push(FIELD_DISPLAY_NAMES_MAP._queriedValue_);headers.push(FIELD_DISPLAY_NAMES_MAP.NO);ALL_DISPLAY_FIELDS_API_KEYS_MAIN.forEach(apiKey=%3E{headers.push(FIELD_DISPLAY_NAMES_MAP[apiKey]||apiKey)})}if(!headers.includes(FIELD_DISPLAY_NAMES_MAP._apiQueryStatus))headers.push(FIELD_DISPLAY_NAMES_MAP._apiQueryStatus);renderTableHeaders(headers)}function%20createA17UnitButtons(){currentTableInstance.a17UnitButtonsContainer.innerHTML='';A17_UNIT_BUTTONS_DEFS.forEach(unitDef=%3E{const%20btn=document.createElement('button');btn.dataset.unitId=unitDef.id;btn.textContent=%60${unitDef.label}%20(0)%60;btn.style.cssText=%60background-color:${unitDef.color};color:white;border:none;padding:6px%208px;border-radius:4px;cursor:pointer;font-size:11px;transition:all%200.2s%20ease;flex-grow:1;min-width:80px;text-align:center;%60;btn.onclick=()=%3E{if(btn.classList.contains('disabled'))return;const%20unitId=btn.dataset.unitId;if(a17ModeState.selectedUnits.has(unitId)){a17ModeState.selectedUnits.delete(unitId);btn.classList.remove('highlighted');btn.style.boxShadow='none'}else{a17ModeState.selectedUnits.add(unitId);btn.classList.add('highlighted');btn.style.boxShadow=%600%200%200%202px%20white,%200%200%200%204px%20${btn.style.backgroundColor}%60}applyTableFilter();displaySystemNotification(%60%E5%B7%B2%E9%81%B8%E6%93%87%20${a17ModeState.selectedUnits.size}%20%E5%80%8B%E5%96%AE%E4%BD%8D%60,!1,1500)};currentTableInstance.a17UnitButtonsContainer.appendChild(btn)})}function%20updateA17UnitButtonCounts(){if(!currentTableInstance.isA17Mode)return;const%20unitCounts={};const%20dataToCount=baseA17MasterData;dataToCount.forEach(row=%3E{const%20unitFull=String(row[FIELD_DISPLAY_NAMES_MAP.uwApproverUnit]||'');let%20unitPrefix='UNDEF';for(const%20code%20in%20UNIT_CODE_MAPPINGS){if(unitFull.toUpperCase().startsWith(code)){unitPrefix=code;break}}if(unitFull.trim()==='')unitPrefix='UNDEF';unitCounts[unitPrefix]=(unitCounts[unitPrefix]||0)+1});currentTableInstance.a17UnitButtonsContainer.querySelectorAll('button').forEach(btn=%3E{const%20unitId=btn.dataset.unitId;const%20count=unitCounts[unitId]||0;const%20unitDef=A17_UNIT_BUTTONS_DEFS.find(def=%3Edef.id===unitId);if(unitDef){btn.textContent=%60${unitDef.label}%20(${count})%60;if(count===0){btn.classList.add('disabled');btn.disabled=!0;btn.style.opacity='0.6';if(a17ModeState.selectedUnits.has(unitId)){a17ModeState.selectedUnits.delete(unitId);btn.classList.remove('highlighted');btn.style.boxShadow='none'}}else{btn.classList.remove('disabled');btn.disabled=!1;btn.style.opacity='1'}}})}function%20handleCopyTable(){const%20dataToCopy=[];const%20rows=currentTableInstance.tableBodyElement.querySelectorAll('tr');rows.forEach(tr=%3E{const%20rowData={};tr.querySelectorAll('td').forEach((td,colIndex)=%3E{if(isEditMode&&colIndex===currentTableInstance.currentHeaders.length)return;const%20headerKey=currentTableInstance.currentHeaders[colIndex];rowData[headerKey]=td.textContent||td.innerText});if(Object.keys(rowData).length%3E0)dataToCopy.push(rowData);});if(dataToCopy.length===0){displaySystemNotification('%E6%B2%92%E6%9C%89%E8%B3%87%E6%96%99%E5%8F%AF%E8%A4%87%E8%A3%BD',!0);return}if(currentTableInstance.isA17Mode){const%20includeText=currentTableInstance.mainUIElement.querySelector(%60#${TOOL_MAIN_CONTAINER_ID}_cbA17IncludeText%60).checked;const%20previewDialog=document.getElementById(TOOL_MAIN_CONTAINER_ID+'_A17TextSettings_overlay');let%20customContentFromPreview=null;if(previewDialog&&previewDialog.style.display==='flex'){const%20previewEl=previewDialog.querySelector('#qt-a17-preview');if(previewEl)customContentFromPreview=previewEl.innerHTML}generateAndCopyA17NotificationHTML(dataToCopy,currentTableInstance.currentHeaders,includeText,customContentFromPreview)}else{let%20tsvContent=currentTableInstance.currentHeaders.join('\t')+'\n';dataToCopy.forEach(row=%3E{const%20rowValues=currentTableInstance.currentHeaders.map(header=%3EString(row[header]||'').replace(/\t/g,'%20').replace(/\n/g,'%20'));tsvContent+=rowValues.join('\t')+'\n'});navigator.clipboard.writeText(tsvContent).then(()=%3EdisplaySystemNotification(%60%E5%B7%B2%E8%A4%87%E8%A3%BD%20${dataToCopy.length}%20%E7%AD%86%E8%B3%87%E6%96%99%20(TSV%E6%A0%BC%E5%BC%8F)%60,!1)).catch(err=%3E{console.error('TSV%E8%A4%87%E8%A3%BD%E5%A4%B1%E6%95%97:',err);displaySystemNotification('%E8%A4%87%E8%A3%BDTSV%E5%A4%B1%E6%95%97',!0)})}}function%20generateAndCopyA17NotificationHTML(data,headers,includeText,customPreviewContent=null){const%20s=a17ModeState.textSettings;const%20today=new%20Date();const%20genDate=new%20Date(today);genDate.setDate(today.getDate()+s.genDateOffset);const%20compDate=new%20Date(today);compDate.setDate(today.getDate()+s.compDateOffset);const%20genDateStr=formatDate(genDate);const%20compDateStr=formatDate(compDate);let%20textContentHtml='';if(includeText){if(customPreviewContent){textContentHtml=customPreviewContent}else{textContentHtml=%60%3Cdiv%20style=%22font-family:'Microsoft%20JhengHei',Arial,sans-serif;font-size:${s.mainFontSize}pt;line-height:${s.mainLineHeight};color:${s.mainFontColor};%22%3E%60+escapeHtml(s.mainContent).replace(/\n/g,'%3Cbr%3E')+%60%3Cbr%3E%3Cbr%3E%3Cp%20style=%22font-size:${s.dateFontSize}pt;line-height:${s.dateLineHeight};color:${s.dateFontColor};margin-top:${s.dateLineHeight%20%3E%201.2%20?%20'10px':'5px'};margin-bottom:${s.dateLineHeight%20%3E%201.2%20?%20'10px':'5px'};%22%3E%E7%94%A2%E6%AA%94%E6%99%82%E9%96%93%EF%BC%9A${genDateStr}%3Cbr%3E%E6%AF%94%E5%B0%8D%E6%99%82%E9%96%93%EF%BC%9A${compDateStr}%3C/p%3E%3C/div%3E%60}}const%20tableRowsHtml=data.map((row,idx)=%3E%60%3Ctr%20style=%22background-color:${idx%20%%202%20?%20'#f8f9fa':'#ffffff'};%22%3E${headers.map(header%20=%3E%20%60%3Ctd%20style=%22border:1px%20solid%20#dddddd;padding:5px%207px;text-align:center;font-size:10pt;color:#333333;white-space:normal;word-break:break-all;%22%3E${escapeHtml(row[header]||'')}%3C/td%3E%60).join('')}%3C/tr%3E%60).join('');const%20tableHtml=%60%3Ctable%20style=%22border-collapse:collapse;width:100%;margin-top:10px;font-family:'Microsoft%20JhengHei',Arial,sans-serif;font-size:10pt;%22%3E%3Cthead%3E%3Ctr%20style=%22background-color:#343a40;color:white;font-weight:bold;%22%3E${headers.map(header%20=%3E%20%60%3Cth%20style=%22border:1px%20solid%20#23272b;padding:6px%208px;text-align:center;%22%3E${escapeHtml(header)}%3C/th%3E%60).join('')}%3C/tr%3E%3C/thead%3E%3Ctbody%3E${tableRowsHtml}%3C/tbody%3E%3C/table%3E%60;const%20finalHtml=textContentHtml+tableHtml;try{const%20blobHtml=new%20Blob([finalHtml],{type:'text/html'});const%20plainTextForClipboard=(includeText?(customPreviewContent?new%20DOMParser().parseFromString(customPreviewContent,%22text/html%22).body.textContent:s.mainContent)+%60\n\n%E7%94%A2%E6%AA%94%E6%99%82%E9%96%93%EF%BC%9A${genDateStr}\n%E6%AF%94%E5%B0%8D%E6%99%82%E9%96%93%EF%BC%9A${compDateStr}\n\n%60:'')+headers.join('\t')+'\n'+data.map(r=%3Eheaders.map(h=%3EString(r[h]||'')).join('\t')).join('\n');const%20blobText=new%20Blob([plainTextForClipboard],{type:'text/plain'});navigator.clipboard.write([new%20ClipboardItem({'text/html':blobHtml,'text/plain':blobText})]).then(()=%3EdisplaySystemNotification('A17%E9%80%9A%E7%9F%A5%E5%B7%B2%E8%A4%87%E8%A3%BD%20(HTML%E6%A0%BC%E5%BC%8F)',!1)).catch(err=%3E{console.error('HTML%20Clipboard%20API%20%E5%A4%B1%E6%95%97:',err);navigator.clipboard.writeText(plainTextForClipboard).then(()=%3EdisplaySystemNotification('A17%E9%80%9A%E7%9F%A5%E5%B7%B2%E8%A4%87%E8%A3%BD%20(%E7%B4%94%E6%96%87%E5%AD%97)',!1)).catch(txtErr=%3EdisplaySystemNotification('%E8%A4%87%E8%A3%BD%E5%A4%B1%E6%95%97',!0))})}catch(e){console.error('ClipboardItem%20API%20%E4%B8%8D%E5%8F%AF%E7%94%A8:',e);const%20plainFallback=(includeText?(customPreviewContent?new%20DOMParser().parseFromString(customPreviewContent,%22text/html%22).body.textContent:s.mainContent)+%60\n\n%E7%94%A2%E6%AA%94%E6%99%82%E9%96%93%EF%BC%9A${genDateStr}\n%E6%AF%94%E5%B0%8D%E6%99%82%E9%96%93%EF%BC%9A${compDateStr}\n\n%60:'')+headers.join('\t')+'\n'+data.map(r=%3Eheaders.map(h=%3EString(r[h]||'')).join('\t')).join('\n');navigator.clipboard.writeText(plainFallback).then(()=%3EdisplaySystemNotification('A17%E9%80%9A%E7%9F%A5%E5%B7%B2%E8%A4%87%E8%A3%BD%20(%E7%B4%94%E6%96%87%E5%AD%97)',!1)).catch(txtErr=%3EdisplaySystemNotification('%E8%A4%87%E8%A3%BD%E5%A4%B1%E6%95%97',!0))}}async%20function%20executeCaseQueryTool(){if(document.getElementById(TOOL_MAIN_CONTAINER_ID)){displaySystemNotification('%E6%9F%A5%E8%A9%A2%E5%B7%A5%E5%85%B7%E5%B7%B2%E9%96%8B%E5%95%9F',!0);return}const%20selectedEnv=await%20createEnvSelectionDialog();if(!selectedEnv){displaySystemNotification('%E6%93%8D%E4%BD%9C%E5%B7%B2%E5%8F%96%E6%B6%88',!0);return}CURRENT_API_URL=selectedEnv==='prod'?API_URL_PROD:API_URL_UAT;displaySystemNotification(%60%E7%92%B0%E5%A2%83:%20${selectedEnv%20===%20'prod'%20?%20'%E6%AD%A3%E5%BC%8F'%20:%20'%E6%B8%AC%E8%A9%A6'}%60,!1);let%20tokenIsValid=!1;if(apiAuthToken)tokenIsValid=!0;if(!tokenIsValid){let%20tokenAttempt=1;while(!0){const%20tokenResult=await%20createTokenDialog(tokenAttempt);if(tokenResult==='_close_tool_'){displaySystemNotification('%E5%B7%A5%E5%85%B7%E5%B7%B2%E9%97%9C%E9%96%89',!1);return}if(tokenResult==='_skip_token_'){apiAuthToken=null;displaySystemNotification('%E5%B7%B2%E7%95%A5%E9%81%8EToken%E8%BC%B8%E5%85%A5',!1);break}if(tokenResult==='_token_dialog_cancel_'){displaySystemNotification('Token%E8%BC%B8%E5%85%A5%E5%B7%B2%E5%8F%96%E6%B6%88',!0);return}if(tokenResult&&tokenResult.trim()!==''){apiAuthToken=tokenResult.trim();localStorage.setItem(TOKEN_STORAGE_KEY,apiAuthToken);displaySystemNotification('Token%E5%B7%B2%E8%A8%AD%E5%AE%9A',!1);break}else{if(tokenAttempt%3E=2){}else{displaySystemNotification('Token%E6%9C%AA%E8%BC%B8%E5%85%A5',!0)}}tokenAttempt++;if(tokenAttempt%3E2&&(!tokenResult||tokenResult.trim()===''))break}}const%20querySetupResult=await%20createQuerySetupDialog();if(!querySetupResult){displaySystemNotification('%E6%93%8D%E4%BD%9C%E5%B7%B2%E5%8F%96%E6%B6%88',!0);return}selectedQueryDefinitionGlobal=QUERYABLE_FIELD_DEFINITIONS.find(qdf=%3Eqdf.queryApiKey===querySetupResult.selectedApiKey);const%20queryValues=querySetupResult.queryValues.split(/[\s,;\n]+/).map(x=%3Ex.trim().toUpperCase()).filter(Boolean);if(queryValues.length===0){displaySystemNotification('%E6%9C%AA%E8%BC%B8%E5%85%A5%E6%9C%89%E6%95%88%E6%9F%A5%E8%A9%A2%E5%80%BC',!0);return}const%20loadingDialog=createDialogBase('_Loading',%60%3Ch3%20class=%22qt-dialog-title%22%20id=%22${TOOL_MAIN_CONTAINER_ID}_LoadingTitle%22%3E%E6%9F%A5%E8%A9%A2%E4%B8%AD...%3C/h3%3E%3Cp%20id=%22${TOOL_MAIN_CONTAINER_ID}_LoadingMsg%22%20style=%22text-align:center;font-size:13px;color:#555;%22%3E%E8%99%95%E7%90%86%E4%B8%AD...%3C/p%3E%3Cdiv%20style=%22width:40px;height:40px;border:4px%20solid%20#f3f3f3;border-top:4px%20solid%20#3498db;border-radius:50%;margin:15px%20auto;animation:qtSpin%201s%20linear%20infinite;%22%3E%3C/div%3E%60,'300px','auto','text-align:center;');const%20loadingTitleEl=loadingDialog.dialog.querySelector(%60#${TOOL_MAIN_CONTAINER_ID}_LoadingTitle%60);const%20loadingMsgEl=loadingDialog.dialog.querySelector(%60#${TOOL_MAIN_CONTAINER_ID}_LoadingMsg%60);originalQueryResults=[];let%20currentQueryCount=0;for(const%20singleQueryValue%20of%20queryValues){currentQueryCount++;if(loadingTitleEl)loadingTitleEl.textContent=%60%E6%9F%A5%E8%A9%A2%E4%B8%AD%20(${currentQueryCount}/${queryValues.length})%60;if(loadingMsgEl)loadingMsgEl.textContent=%60%E6%AD%A3%E5%9C%A8%E8%99%95%E7%90%86:%20${singleQueryValue}%60;const%20resultRowBase={[FIELD_DISPLAY_NAMES_MAP.NO]:String(currentQueryCount),[FIELD_DISPLAY_NAMES_MAP._queriedValue_]:singleQueryValue};const%20apiResult=await%20performApiQuery(singleQueryValue,selectedQueryDefinitionGlobal.queryApiKey);let%20apiQueryStatusText='%E2%9D%8C%20%E6%9F%A5%E8%A9%A2%E5%A4%B1%E6%95%97';if(apiResult.error==='token_invalid'){apiQueryStatusText='%E2%9D%8C%20TOKEN%E5%A4%B1%E6%95%88';loadingDialog.overlay.remove();displaySystemNotification('Token%E5%B7%B2%E5%A4%B1%E6%95%88%E6%88%96%E7%84%A1%E6%95%88%EF%BC%8C%E8%AB%8B%E9%87%8D%E6%96%B0%E8%A8%AD%E5%AE%9AToken%E5%BE%8C%E5%86%8D%E6%AC%A1%E6%9F%A5%E8%A9%A2%E3%80%82',!0,5000);apiAuthToken=null;return}else%20if(apiResult.success){apiQueryStatusText='%E2%9C%94%EF%B8%8F%20%E6%88%90%E5%8A%9F'}else%20if(!apiResult.error){apiQueryStatusText='%E2%9E%96%20%E6%9F%A5%E7%84%A1%E8%B3%87%E6%96%99'}resultRowBase[FIELD_DISPLAY_NAMES_MAP._apiQueryStatus]=apiQueryStatusText;if(apiResult.success&&apiResult.data.records){apiResult.data.records.forEach(rec=%3E{const%20populatedRow={...resultRowBase};ALL_DISPLAY_FIELDS_API_KEYS_MAIN.forEach(dKey=%3E{const%20displayName=FIELD_DISPLAY_NAMES_MAP[dKey]||dKey;let%20cellValue=rec[dKey]===null||rec[dKey]===undefined?'':String(rec[dKey]);if(dKey==='statusCombined'){const%20mainS=rec.mainStatus||'';const%20subS=rec.subStatus||'';populatedRow[displayName]=%60%3Cspan%20style=%22font-weight:bold;%22%3E${escapeHtml(mainS)}%3C/span%3E%60+(subS?%60%20%3Cspan%20style=%22color:#777;%22%3E(${escapeHtml(subS)})%3C/span%3E%60:'')}else%20if(dKey===UNIT_MAP_FIELD_API_KEY){const%20unitCodePrefix=getFirstLetter(cellValue);const%20mappedUnitName=UNIT_CODE_MAPPINGS[unitCodePrefix]||cellValue;populatedRow[displayName]=unitCodePrefix&&UNIT_CODE_MAPPINGS[unitCodePrefix]?%60${unitCodePrefix}-${mappedUnitName.replace(/^[A-Z]-/,'')}%60:mappedUnitName}else%20if(dKey==='uwApprover'||dKey==='approvalUser'){populatedRow[displayName]=extractName(cellValue)}else{populatedRow[displayName]=cellValue}});originalQueryResults.push(populatedRow)})}else{ALL_DISPLAY_FIELDS_API_KEYS_MAIN.forEach(dKey=%3E{resultRowBase[FIELD_DISPLAY_NAMES_MAP[dKey]||dKey]='-'});originalQueryResults.push(resultRowBase)}}loadingDialog.overlay.remove();if(originalQueryResults.length%3E0)originalQueryResults.sort((a,b)=%3E(parseInt(a[FIELD_DISPLAY_NAMES_MAP.NO])||0)-(parseInt(b[FIELD_DISPLAY_NAMES_MAP.NO])||0));currentTableInstance.isA17Mode=!1;a17ModeState.isActive=!1;isEditMode=!1;renderResultsTableUI(originalQueryResults);displaySystemNotification(%60%E6%9F%A5%E8%A9%A2%E5%AE%8C%E6%88%90%EF%BC%81%E5%85%B1%E8%99%95%E7%90%86%20${queryValues.length}%20%E5%80%8B%E6%9F%A5%E8%A9%A2%E5%80%BC%EF%BC%8C%E7%8D%B2%E5%8F%96%20${originalQueryResults.length}%20%E7%AD%86%E8%B3%87%E6%96%99%60,!1,3500)}(function(){document.getElementById(TOOL_MAIN_CONTAINER_ID)?.remove();['EnvSelect','Token','QuerySetup','A17TextSettings','Loading','CSVPurpose','CSVColSelect','CSVCheckbox'].forEach(suffix=%3E{const%20el=document.getElementById(TOOL_MAIN_CONTAINER_ID+'_'+suffix+'_overlay');if(el)el.remove();});document.getElementById(TOOL_MAIN_CONTAINER_ID+'_Notification')?.remove();loadA17TextSettings();executeCaseQueryTool()})()})()
