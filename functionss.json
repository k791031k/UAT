[
  {
    "id": "A17.06",
    "description": "A17.06",
    "category": "A17查詢",
    "type": "action",
    "action_script": "javascript:(async()=>{const API_URL_UAT='https://euisv-uat.apps.tocp4.kgilife.com.tw/euisw/euisb/api/caseQuery/query',API_URL_PROD='https://euisv.apps.ocp4.kgilife.com.tw/euisw/euisb/api/caseQuery/query',TOKEN_STORAGE_KEY='euisToken',Z_INDEX_DIALOG=2147483640,Z_INDEX_MAIN_UI=2147483630,Z_INDEX_NOTIFICATION=2147483647;let CURRENT_API_URL='',apiAuthToken=localStorage.getItem(TOKEN_STORAGE_KEY),selectedQueryDefinitionGlobal=null,originalQueryResults=[],baseA17MasterData=[],isEditMode=false,currentTableInstance={sortDirections:{},currentHeaders:[],isA17Mode:false,isCSVImportModeGlobal:false},a17ModeState={isActive:false,selectedUnits:new Set(),sortedData:[]},csvImportState={isImported:false,headers:[],selectedColumn:null,fileName:'',csvHeaders:[]};const QUERYABLE_FIELD_DEFINITIONS=[{queryApiKey:'receiptNumber',queryDisplayName:'送金單號碼',color:'#007bff'},{queryApiKey:'applyNumber',queryDisplayName:'受理號碼',color:'#6f42c1'},{queryApiKey:'policyNumber',queryDisplayName:'保單號碼',color:'#28a745'},{queryApiKey:'approvalNumber',queryDisplayName:'確認書編號',color:'#fd7e14'},{queryApiKey:'insuredId',queryDisplayName:'被保人ＩＤ',color:'#17a2b8'}],ALL_DISPLAY_FIELDS_API_KEYS_MAIN=['applyNumber','policyNumber','approvalNumber','receiptNumber','insuredId','statusCombined','uwApproverUnit','uwApprover','approvalUser'],FIELD_DISPLAY_NAMES_MAP={applyNumber:'受理號碼',policyNumber:'保單號碼',approvalNumber:'確認書編號',receiptNumber:'送金單',insuredId:'被保人ＩＤ',statusCombined:'狀態',uwApproverUnit:'分公司',uwApprover:'核保員',approvalUser:'覆核'},UNIT_MAP_FIELD_API_KEY='uwApproverUnit',UNIT_CODE_MAPPINGS={H:'核保部',B:'北一',C:'台中',K:'高雄',N:'台南',P:'北二',T:'桃竹',G:'保作'},A17_UNIT_BUTTONS_DEFS=[{id:'H',label:'H-總公司',color:'#007bff'},{id:'B',label:'B-北一',color:'#28a745'},{id:'P',label:'P-北二',color:'#ffc107'},{id:'T',label:'T-桃竹',color:'#17a2b8'},{id:'C',label:'C-台中',color:'#fd7e14'},{id:'N',label:'N-台南',color:'#6f42c1'},{id:'K',label:'K-高雄',color:'#e83e8c'},{id:'UNDEF',label:'查無',color:'#546e7a'}],A17_CSV_DISPLAY_HEADERS=['送金單','科目代碼','幣別','餘額','入帳日期','入帳人員','保單狀態'],A17_API_DATA_DISPLAY_HEADERS=['受理號碼','保單號碼','確認書編號','分公司','核保員'],A17_COPY_ONLY_HEADERS=['送金單','科目代碼','幣別','餘額','入帳日期','入帳人員','保單狀態','保單號碼','分公司','核保員','',''],A17_PARA1=\"您好，\",A17_PARA2_TEMPLATE=\"依據【管理報表：A17 新契約異常帳務】所載內容，本週報表中列示之送金單號碼，涉及多項帳務異常情形，例如：溢繳、短收、取消件需退費、無相對應之案件等問題。\",A17_PARA3=\"經逐筆查詢比對後，該等送金單應對應至下表所列之新契約案件，敬請協助確認各案件之帳務狀況，謝謝。\";let textSettings={content:A17_PARA1+'\\n\\n'+A17_PARA2_TEMPLATE+'\\n\\n'+A17_PARA3,fontSize:10.5,lineHeight:1.5};function loadTextSettings(){const saved=localStorage.getItem('qt_a17_text_settings');if(saved)try{textSettings={...textSettings,...JSON.parse(saved)}}catch(e){}}function saveTextSettings(){localStorage.setItem('qt_a17_text_settings',JSON.stringify(textSettings))}function escapeHtml(s){return s===undefined||s===null?'':String(s).replace(/[&<\"']/g,m=>({'&':'&amp;','<':'&lt;','\"':'&quot;',\"'\":\"&#039;\",'>':'&gt;'}[m]));} })();"
  },
  {
    "id": "New A17序號",
    "description": "New A17序號",
    "category": "A17查詢",
    "type": "utility",
    "action_script": "javascript:(async()=>{const sleep=t=>new Promise(r=>setTimeout(r,t)),API_URL='https://euisv.apps.ocp4.kgilife.com.tw/euisw/euisb/api/caseQuery/query',fields=['receiptNumber','applyNumber','policyNumber','approvalNumber','mainStatus','subStatus','uwApproverUnit','uwApprover','approvalUser'],fieldNames={receiptNumber:'送金單號碼',applyNumber:'受理號碼',policyNumber:'保單號碼',approvalNumber:'確認書編號',mainStatus:'主狀態',subStatus:'次狀態',uwApproverUnit:{H:'核保部',B:'北一',C:'台中',F:'台中(嘉義)',K:'高雄',N:'台南',P:'北二',T:'桃竹',G:'保作'},uwApprover:'核保人員',approvalUser:'審核人員'};let token=localStorage.getItem('euisToken');while(!token){token=prompt('找不到TOKEN，請輸入');if(!token)return alert('查詢中止');localStorage.setItem('euisToken',token);}const input=prompt('請輸入送金單號碼（用空格、逗號、分號或換行分隔）');if(!input)return;const numbers=input.split(/[\\s,;\\n]+/).map(x=>x.trim()).filter(Boolean);if(numbers.length===0)return alert('未輸入有效單號');let results=[],counter=1;for(const num of numbers){let retries=3,success=false;while(retries-->0&&!success)try{const res=await fetch(API_URL,{method:'POST',headers:{'Content-Type':'application/json','SSO-TOKEN':token},body:JSON.stringify({currentPage:1,pageSize:10,receiptNumber:num})}),data=await res.json();if(data.records&&data.records.length){data.records.forEach(record=>{const row={'序號':counter++,'送金單號碼':num};fields.slice(1).forEach(f=>{if(f==='uwApproverUnit'){const apiValue=record[f]||'';let firstLetter='';for(let i=0;i<apiValue.length;i++){if(/[A-Za-z]/.test(apiValue.charAt(i))){firstLetter=apiValue.charAt(i).toUpperCase();break;}}const mappedValue=firstLetter&&fieldNames[f][firstLetter]?fieldNames[f][firstLetter]:apiValue;row['核保單位']=firstLetter?firstLetter+'-'+mappedValue.replace(/^[A-Za-z]-/,''):mappedValue;}else{row[fieldNames[f]]=record[f]||''}});results.push(row)});success=true}else{const row={'序號':counter++,'送金單號碼':num};fields.slice(1).forEach(f=>row[f==='uwApproverUnit'?'核保單位':fieldNames[f]]='');results.push(row);success=true}}catch(e){console.error(`錯誤：${num}`,e);await sleep(1000);}await sleep(1000);}let container=document.getElementById('queryPreviewContainer');if(container)container.remove();container=document.createElement('div');container.id='queryPreviewContainer';container.style='position:fixed;top:30px;left:30px;z-index:99999;background:#fff;padding:18px;border-radius:8px;box-shadow:0 4px 16px #0002;max-height:80vh;overflow:auto;font-size:14px;';const table=document.createElement('table');table.style='border-collapse:collapse;min-width:900px;';const headers=['序號','送金單號碼',...fields.slice(1).map(f=>f==='uwApproverUnit'?'核保單位':fieldNames[f])],trh=document.createElement('tr');headers.forEach(h=>{const th=document.createElement('th');th.textContent=h;th.style='border:1px solid #ccc;padding:4px 8px;background:#f6f6f6;';trh.appendChild(th);});table.appendChild(trh);results.forEach(row=>{const tr=document.createElement('tr');headers.forEach(h=>{const td=document.createElement('td');td.textContent=row[h]||'';td.style='border:1px solid #ccc;padding:4px 8px;';tr.appendChild(td)});table.appendChild(tr)});container.innerHTML='<div style=\"font-weight:bold;margin-bottom:8px;\">查詢結果預覽</div>';container.appendChild(table);const btnCopy=document.createElement('button'),btnExcel=document.createElement('button'),btnClose=document.createElement('button');btnCopy.textContent='複製';btnExcel.textContent='下載 Excel';btnClose.textContent='關閉';[btnCopy,btnExcel,btnClose].forEach(btn=>btn.style='margin:12px 8px 0 0;font-size:14px;');btnCopy.onclick=()=>{const rows=[headers,...results.map(row=>headers.map(h=>row[h]||''))];navigator.clipboard.writeText(rows.map(r=>r.join('\\t')).join('\\n')).then(()=>{btnCopy.textContent='已複製!';setTimeout(()=>btnCopy.textContent='複製',1200);})};btnExcel.onclick=async()=>{if(!window.XLSX){const s=document.createElement('script');s.src='https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js';document.body.appendChild(s);await new Promise(r=>s.onload=r);}const wb=XLSX.utils.book_new(),ws=XLSX.utils.json_to_sheet(results);XLSX.utils.book_append_sheet(wb,ws,'查詢結果');XLSX.writeFile(wb,`送金單查詢_${new Date().toISOString().slice(0,10)}.xlsx`)};btnClose.onclick=()=>container.remove();container.appendChild(document.createElement('br'));container.appendChild(btnCopy);container.appendChild(btnExcel);container.appendChild(btnClose);document.body.appendChild(container);})();"
  },
  {
    "id": "A171.js",
    "description": "A171.js",
    "category": "a17",
    "type": "action",
    "action_script": "external:https://cdn.jsdelivr.net/gh/k791031k/UAT_TOOL_R/A171.js"
  },
  {
    "id": "A172.js",
    "description": "A172.js",
    "category": "a17",
    "type": "action",
    "action_script": "external:https://cdn.jsdelivr.net/gh/k791031k/UAT_TOOL_R/A172.js"
  },
  {
    "id": "EZC1.js",
    "description": "EZC1.js",
    "category": "ezc",
    "type": "utility",
    "action_script": "external:https://cdn.jsdelivr.net/gh/k791031k/UAT_TOOL_R/EZC1.js"
  },
  {
    "id": "EZC2.js",
    "description": "EZC2.js",
    "category": "ezc",
    "type": "utility",
    "action_script": "external:https://cdn.jsdelivr.net/gh/k791031k/UAT_TOOL_R/EZC2.js"
  },
  {
    "id": "EZC3.js",
    "description": "EZC3.js",
    "category": "ezc",
    "type": "utility",
    "action_script": "external:https://cdn.jsdelivr.net/gh/k791031k/UAT_TOOL_R/EZC3.js"
  },
  {
    "id": "P0.js",
    "description": "P0.js",
    "category": "plan",
    "type": "action",
    "action_script": "external:https://cdn.jsdelivr.net/gh/k791031k/UAT_TOOL_R/P0.js"
  },
  {
    "id": "P1.js",
    "description": "P1.js",
    "category": "plan",
    "type": "action",
    "action_script": "external:https://cdn.jsdelivr.net/gh/k791031k/UAT_TOOL_R/P1.js"
  },
  {
    "id": "P3.js",
    "description": "P3.js",
    "category": "plan",
    "type": "action",
    "action_script": "external:https://cdn.jsdelivr.net/gh/k791031k/UAT_TOOL_R/P3.js"
  },
  {
    "id": "P4.js",
    "description": "P4.js",
    "category": "plan",
    "type": "action",
    "action_script": "external:https://cdn.jsdelivr.net/gh/k791031k/UAT_TOOL_R/P4.js"
  },
  {
    "id": "P5.js",
    "description": "P5.js",
    "category": "plan",
    "type": "action",
    "action_script": "external:https://cdn.jsdelivr.net/gh/k791031k/UAT_TOOL_R/P5.js"
  },
  {
    "id": "P6.js",
    "description": "P6.js",
    "category": "plan",
    "type": "action",
    "action_script": "external:https://cdn.jsdelivr.net/gh/k791031k/UAT_TOOL_R/P6.js"
  },
  {
    "id": "P7.js",
    "description": "P7.js",
    "category": "plan",
    "type": "action",
    "action_script": "external:https://cdn.jsdelivr.net/gh/k791031k/UAT_TOOL_R/P7.js"
  },
  {
    "id": "P8.js",
    "description": "P8.js",
    "category": "plan",
    "type": "action",
    "action_script": "external:https://cdn.jsdelivr.net/gh/k791031k/UAT_TOOL_R/P8.js"
  }
]
